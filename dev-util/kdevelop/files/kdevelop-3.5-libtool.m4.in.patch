admin/libtool.m4.in
===================================================================
--- parts/appwizard/common/admin/libtool.m4.in	2007-12-01 00:39:20.000000000 +0200
+++ parts/appwizard/common/admin/libtool.m4.in	2008-10-20 18:41:40.000000000 +0300
@@ -298,8 +298,8 @@
 elif test "X[$]1" = X--fallback-echo; then
   # Avoid inline document here, it may be left over
   :
-elif test "X`($echo '\t') 2>/dev/null`" = 'X\t' ; then
-  # Yippee, $echo works!
+elif test "X`($ECHO '\t') 2>/dev/null`" = 'X\t' ; then
+  # Yippee, $ECHO works!
   :
 else
   # Restart under the correct shell.
@@ -326,16 +326,16 @@
     # expected sizes: less than 2Kb, 1Kb, 512 bytes, 16 bytes, ...
     if (echo_test_string="`eval $cmd`") 2>/dev/null &&
        echo_test_string="`eval $cmd`" &&
-       (test "X$echo_test_string" = "X$echo_test_string") 2>/dev/null
+       (test "X$ECHO_test_string" = "X$ECHO_test_string") 2>/dev/null
     then
       break
     fi
   done
 fi
 
-if test "X`($echo '\t') 2>/dev/null`" = 'X\t' &&
-   echo_testing_string=`($echo "$echo_test_string") 2>/dev/null` &&
-   test "X$echo_testing_string" = "X$echo_test_string"; then
+if test "X`($ECHO '\t') 2>/dev/null`" = 'X\t' &&
+   echo_testing_string=`($ECHO "$ECHO_test_string") 2>/dev/null` &&
+   test "X$ECHO_testing_string" = "X$ECHO_test_string"; then
   :
 else
   # The Solaris, AIX, and Digital Unix default echo programs unquote
@@ -349,19 +349,19 @@
     IFS="$lt_save_ifs"
     if (test -f $dir/echo || test -f $dir/echo$ac_exeext) &&
        test "X`($dir/echo '\t') 2>/dev/null`" = 'X\t' &&
-       echo_testing_string=`($dir/echo "$echo_test_string") 2>/dev/null` &&
-       test "X$echo_testing_string" = "X$echo_test_string"; then
+       echo_testing_string=`($dir/echo "$ECHO_test_string") 2>/dev/null` &&
+       test "X$ECHO_testing_string" = "X$ECHO_test_string"; then
       echo="$dir/echo"
       break
     fi
   done
   IFS="$lt_save_ifs"
 
-  if test "X$echo" = Xecho; then
+  if test "X$ECHO" = Xecho; then
     # We didn't find a better echo, so look for alternatives.
     if test "X`(print -r '\t') 2>/dev/null`" = 'X\t' &&
-       echo_testing_string=`(print -r "$echo_test_string") 2>/dev/null` &&
-       test "X$echo_testing_string" = "X$echo_test_string"; then
+       echo_testing_string=`(print -r "$ECHO_test_string") 2>/dev/null` &&
+       test "X$ECHO_testing_string" = "X$ECHO_test_string"; then
       # This shell has a builtin print -r that does the trick.
       echo='print -r'
     elif (test -f /bin/ksh || test -f /bin/ksh$ac_exeext) &&
@@ -375,31 +375,31 @@
     else
       # Try using printf.
       echo='printf %s\n'
-      if test "X`($echo '\t') 2>/dev/null`" = 'X\t' &&
-	 echo_testing_string=`($echo "$echo_test_string") 2>/dev/null` &&
-	 test "X$echo_testing_string" = "X$echo_test_string"; then
+      if test "X`($ECHO '\t') 2>/dev/null`" = 'X\t' &&
+	 echo_testing_string=`($ECHO "$ECHO_test_string") 2>/dev/null` &&
+	 test "X$ECHO_testing_string" = "X$ECHO_test_string"; then
 	# Cool, printf works
 	:
       elif echo_testing_string=`($ORIGINAL_CONFIG_SHELL "[$]0" --fallback-echo '\t') 2>/dev/null` &&
-	   test "X$echo_testing_string" = 'X\t' &&
-	   echo_testing_string=`($ORIGINAL_CONFIG_SHELL "[$]0" --fallback-echo "$echo_test_string") 2>/dev/null` &&
-	   test "X$echo_testing_string" = "X$echo_test_string"; then
+	   test "X$ECHO_testing_string" = 'X\t' &&
+	   echo_testing_string=`($ORIGINAL_CONFIG_SHELL "[$]0" --fallback-echo "$ECHO_test_string") 2>/dev/null` &&
+	   test "X$ECHO_testing_string" = "X$ECHO_test_string"; then
 	CONFIG_SHELL=$ORIGINAL_CONFIG_SHELL
 	export CONFIG_SHELL
 	SHELL="$CONFIG_SHELL"
 	export SHELL
 	echo="$CONFIG_SHELL [$]0 --fallback-echo"
       elif echo_testing_string=`($CONFIG_SHELL "[$]0" --fallback-echo '\t') 2>/dev/null` &&
-	   test "X$echo_testing_string" = 'X\t' &&
-	   echo_testing_string=`($CONFIG_SHELL "[$]0" --fallback-echo "$echo_test_string") 2>/dev/null` &&
-	   test "X$echo_testing_string" = "X$echo_test_string"; then
+	   test "X$ECHO_testing_string" = 'X\t' &&
+	   echo_testing_string=`($CONFIG_SHELL "[$]0" --fallback-echo "$ECHO_test_string") 2>/dev/null` &&
+	   test "X$ECHO_testing_string" = "X$ECHO_test_string"; then
 	echo="$CONFIG_SHELL [$]0 --fallback-echo"
       else
 	# maybe with a smaller string...
 	prev=:
 
 	for cmd in 'echo test' 'sed 2q "[$]0"' 'sed 10q "[$]0"' 'sed 20q "[$]0"' 'sed 50q "[$]0"'; do
-	  if (test "X$echo_test_string" = "X`eval $cmd`") 2>/dev/null
+	  if (test "X$ECHO_test_string" = "X`eval $cmd`") 2>/dev/null
 	  then
 	    break
 	  fi
@@ -422,7 +422,7 @@
 
 # Copy echo and quote the copy suitably for passing to libtool from
 # the Makefile, instead of quoting the original, which is used later.
-ECHO=$echo
+ECHO=$ECHO
 if test "X$ECHO" = "X$CONFIG_SHELL [$]0 --fallback-echo"; then
    ECHO="$CONFIG_SHELL \\\$\[$]0 --fallback-echo"
 fi
@@ -1160,7 +1160,7 @@
 amigaos*)
   library_names_spec='$libname.ixlibrary $libname.a'
   # Create ${libname}_ixlibrary.a entries in /sys/libs.
-  finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`$echo "X$lib" | $Xsed -e '\''s%^.*/\([[^/]]*\)\.ixlibrary$%\1%'\''`; test $rm /sys/libs/${libname}_ixlibrary.a; $show "(cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a)"; (cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a) || exit 1; done'
+  finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`$ECHO "X$lib" | $Xsed -e '\''s%^.*/\([[^/]]*\)\.ixlibrary$%\1%'\''`; test $rm /sys/libs/${libname}_ixlibrary.a; $show "(cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a)"; (cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a) || exit 1; done'
   ;;
 
 beos*)
@@ -1633,7 +1633,7 @@
   for tagname in $tagnames; do
     IFS="$lt_save_ifs"
     # Check whether tagname contains only valid characters
-    case `$echo "X$tagname" | $Xsed -e 's:[[-_ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890,/]]::g'` in
+    case `$ECHO "X$tagname" | $Xsed -e 's:[[-_ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890,/]]::g'` in
     "") ;;
     *)  AC_MSG_ERROR([invalid tag name: $tagname])
 	;;
@@ -2681,7 +2681,7 @@
 CC=${CXX-"c++"}
 compiler=$CC
 _LT_AC_TAGVAR(compiler, $1)=$CC
-cc_basename=`$echo X"$compiler" | $Xsed -e 's%^.*/%%'`
+cc_basename=`$ECHO X"$compiler" | $Xsed -e 's%^.*/%%'`
 
 # We don't want -fno-exception wen compiling C++ code, so set the
 # no_builtin_flag separately
@@ -3356,7 +3356,7 @@
 	# Sun C++ 4.2, 5.x and Centerline C++
 	_LT_AC_TAGVAR(no_undefined_flag, $1)=' -zdefs'
 	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -G${allow_undefined_flag} -nolib -h$soname -o $lib $compiler_flags $predep_objects $libobjs $deplibs $postdep_objects'
-	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='$echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~$echo "local: *; };" >> $lib.exp~
+	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='$ECHO "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~$ECHO "local: *; };" >> $lib.exp~
 	$CC -G${allow_undefined_flag} -nolib ${wl}-M ${wl}$lib.exp -h$soname -o $lib $compiler_flags $predep_objects $libobjs $deplibs $postdep_objects~$rm $lib.exp'
 
 	_LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='-R$libdir'
@@ -3402,7 +3402,7 @@
 	  _LT_AC_TAGVAR(no_undefined_flag, $1)=' ${wl}-z ${wl}defs'
 	  if $CC --version | grep -v '^2\.7' > /dev/null; then
 	    _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $LDFLAGS $compiler_flags $predep_objects $libobjs $deplibs $postdep_objects ${wl}-h $wl$soname -o $lib'
-	    _LT_AC_TAGVAR(archive_expsym_cmds, $1)='$echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~$echo "local: *; };" >> $lib.exp~
+	    _LT_AC_TAGVAR(archive_expsym_cmds, $1)='$ECHO "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~$ECHO "local: *; };" >> $lib.exp~
 		$CC -shared -nostdlib ${wl}-M $wl$lib.exp -o $lib $compiler_flags $predep_objects $libobjs $deplibs $postdep_objects~$rm $lib.exp'
 
 	    # Commands to make compiler produce verbose output that lists
@@ -3413,7 +3413,7 @@
 	    # g++ 2.7 appears to require `-G' NOT `-shared' on this
 	    # platform.
 	    _LT_AC_TAGVAR(archive_cmds, $1)='$CC -G -nostdlib $LDFLAGS $compiler_flags $predep_objects $libobjs $deplibs $postdep_objects ${wl}-h $wl$soname -o $lib'
-	    _LT_AC_TAGVAR(archive_expsym_cmds, $1)='$echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~$echo "local: *; };" >> $lib.exp~
+	    _LT_AC_TAGVAR(archive_expsym_cmds, $1)='$ECHO "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~$ECHO "local: *; };" >> $lib.exp~
 		$CC -G -nostdlib ${wl}-M $wl$lib.exp -o $lib $compiler_flags $predep_objects $libobjs $deplibs $postdep_objects~$rm $lib.exp'
 
 	    # Commands to make compiler produce verbose output that lists
@@ -3542,7 +3542,7 @@
   # The `*' in the case matches for architectures that use `case' in
   # $output_verbose_cmd can trigger glob expansion during the loop
   # eval without this substitution.
-  output_verbose_link_cmd="`$echo \"X$output_verbose_link_cmd\" | $Xsed -e \"$no_glob_subst\"`"
+  output_verbose_link_cmd="`$ECHO \"X$output_verbose_link_cmd\" | $Xsed -e \"$no_glob_subst\"`"
 
   for p in `eval $output_verbose_link_cmd`; do
     case $p in
@@ -3673,7 +3673,7 @@
 CC=${F77-"f77"}
 compiler=$CC
 _LT_AC_TAGVAR(compiler, $1)=$CC
-cc_basename=`$echo X"$compiler" | $Xsed -e 's%^.*/%%'`
+cc_basename=`$ECHO X"$compiler" | $Xsed -e 's%^.*/%%'`
 
 AC_MSG_CHECKING([if libtool supports shared libraries])
 AC_MSG_RESULT([$can_build_shared])
@@ -3895,17 +3895,17 @@
     old_postinstall_cmds | old_postuninstall_cmds | \
     sys_lib_search_path_spec | sys_lib_dlsearch_path_spec)
       # Double-quote double-evaled strings.
-      eval "lt_$var=\\\"\`\$echo \"X\$$var\" | \$Xsed -e \"\$double_quote_subst\" -e \"\$sed_quote_subst\" -e \"\$delay_variable_subst\"\`\\\""
+      eval "lt_$var=\\\"\`\$ECHO \"X\$$var\" | \$Xsed -e \"\$double_quote_subst\" -e \"\$sed_quote_subst\" -e \"\$delay_variable_subst\"\`\\\""
       ;;
     *)
-      eval "lt_$var=\\\"\`\$echo \"X\$$var\" | \$Xsed -e \"\$sed_quote_subst\"\`\\\""
+      eval "lt_$var=\\\"\`\$ECHO \"X\$$var\" | \$Xsed -e \"\$sed_quote_subst\"\`\\\""
       ;;
     esac
   done
 
   case $lt_echo in
   *'\[$]0 --fallback-echo"')
-    lt_echo=`$echo "X$lt_echo" | $Xsed -e 's/\\\\\\\[$]0 --fallback-echo"[$]/[$]0 --fallback-echo"/'`
+    lt_echo=`$ECHO "X$lt_echo" | $Xsed -e 's/\\\\\\\[$]0 --fallback-echo"[$]/[$]0 --fallback-echo"/'`
     ;;
   esac
 
@@ -3920,7 +3920,7 @@
 ifelse([$1], [],
 [#! $SHELL
 
-# `$echo "$cfgfile" | sed 's%^.*/%%'` - Provide generalized library-building support services.
+# `$ECHO "$cfgfile" | sed 's%^.*/%%'` - Provide generalized library-building support services.
 # Generated automatically by $PROGRAM (GNU $PACKAGE $VERSION$TIMESTAMP)
 # NOTE: Changes made to this file will be lost: look at ltmain.sh.
 #
@@ -5066,7 +5066,7 @@
       ;;
 
     amigaos*)
-      _LT_AC_TAGVAR(archive_cmds, $1)='$rm $output_objdir/a2ixlibrary.data~$echo "#define NAME $libname" > $output_objdir/a2ixlibrary.data~$echo "#define LIBRARY_ID 1" >> $output_objdir/a2ixlibrary.data~$echo "#define VERSION $major" >> $output_objdir/a2ixlibrary.data~$echo "#define REVISION $revision" >> $output_objdir/a2ixlibrary.data~$AR $AR_FLAGS $lib $libobjs~$RANLIB $lib~(cd $output_objdir && a2ixlibrary -32)'
+      _LT_AC_TAGVAR(archive_cmds, $1)='$rm $output_objdir/a2ixlibrary.data~$ECHO "#define NAME $libname" > $output_objdir/a2ixlibrary.data~$ECHO "#define LIBRARY_ID 1" >> $output_objdir/a2ixlibrary.data~$ECHO "#define VERSION $major" >> $output_objdir/a2ixlibrary.data~$ECHO "#define REVISION $revision" >> $output_objdir/a2ixlibrary.data~$AR $AR_FLAGS $lib $libobjs~$RANLIB $lib~(cd $output_objdir && a2ixlibrary -32)'
       _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='-L$libdir'
       _LT_AC_TAGVAR(hardcode_minus_L, $1)=yes
 
@@ -5297,7 +5297,7 @@
       ;;
 
     amigaos*)
-      _LT_AC_TAGVAR(archive_cmds, $1)='$rm $output_objdir/a2ixlibrary.data~$echo "#define NAME $libname" > $output_objdir/a2ixlibrary.data~$echo "#define LIBRARY_ID 1" >> $output_objdir/a2ixlibrary.data~$echo "#define VERSION $major" >> $output_objdir/a2ixlibrary.data~$echo "#define REVISION $revision" >> $output_objdir/a2ixlibrary.data~$AR $AR_FLAGS $lib $libobjs~$RANLIB $lib~(cd $output_objdir && a2ixlibrary -32)'
+      _LT_AC_TAGVAR(archive_cmds, $1)='$rm $output_objdir/a2ixlibrary.data~$ECHO "#define NAME $libname" > $output_objdir/a2ixlibrary.data~$ECHO "#define LIBRARY_ID 1" >> $output_objdir/a2ixlibrary.data~$ECHO "#define VERSION $major" >> $output_objdir/a2ixlibrary.data~$ECHO "#define REVISION $revision" >> $output_objdir/a2ixlibrary.data~$AR $AR_FLAGS $lib $libobjs~$RANLIB $lib~(cd $output_objdir && a2ixlibrary -32)'
       _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='-L$libdir'
       _LT_AC_TAGVAR(hardcode_minus_L, $1)=yes
       # see comment about different semantics on the GNU ld section
@@ -5540,7 +5540,7 @@
       _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='-L$libdir'
       _LT_AC_TAGVAR(hardcode_minus_L, $1)=yes
       _LT_AC_TAGVAR(allow_undefined_flag, $1)=unsupported
-      _LT_AC_TAGVAR(archive_cmds, $1)='$echo "LIBRARY $libname INITINSTANCE" > $output_objdir/$libname.def~$echo "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~$echo DATA >> $output_objdir/$libname.def~$echo " SINGLE NONSHARED" >> $output_objdir/$libname.def~$echo EXPORTS >> $output_objdir/$libname.def~emxexp $libobjs >> $output_objdir/$libname.def~$CC -Zdll -Zcrtdll -o $lib $compiler_flags $libobjs $deplibs$output_objdir/$libname.def'
+      _LT_AC_TAGVAR(archive_cmds, $1)='$ECHO "LIBRARY $libname INITINSTANCE" > $output_objdir/$libname.def~$ECHO "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~$ECHO DATA >> $output_objdir/$libname.def~$ECHO " SINGLE NONSHARED" >> $output_objdir/$libname.def~$ECHO EXPORTS >> $output_objdir/$libname.def~emxexp $libobjs >> $output_objdir/$libname.def~$CC -Zdll -Zcrtdll -o $lib $compiler_flags $libobjs $deplibs$output_objdir/$libname.def'
       _LT_AC_TAGVAR(old_archive_From_new_cmds, $1)='emximp -o $output_objdir/$libname.a $output_objdir/$libname.def'
       ;;
 
@@ -5585,11 +5585,11 @@
       _LT_AC_TAGVAR(no_undefined_flag, $1)=' -z text'
       if test "$GCC" = yes; then
 	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared ${wl}-h ${wl}$soname -o $lib $compiler_flags $libobjs $deplibs'
-	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='$echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~$echo "local: *; };" >> $lib.exp~
+	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='$ECHO "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~$ECHO "local: *; };" >> $lib.exp~
 	  $CC -shared ${wl}-M ${wl}$lib.exp ${wl}-h ${wl}$soname -o $lib $compiler_flags $libobjs $deplibs~$rm $lib.exp'
       else
 	_LT_AC_TAGVAR(archive_cmds, $1)='$LD -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $linker_flags'
-	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='$echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~$echo "local: *; };" >> $lib.exp~
+	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='$ECHO "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~$ECHO "local: *; };" >> $lib.exp~
   	$LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags~$rm $lib.exp'
       fi
       _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='-R$libdir'
@@ -5679,7 +5679,7 @@
       # $CC -shared without GNU ld will not create a library from C++
       # object files and a static libstdc++, better avoid it by now
       _LT_AC_TAGVAR(archive_cmds, $1)='$LD -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $linker_flags'
-      _LT_AC_TAGVAR(archive_expsym_cmds, $1)='$echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~$echo "local: *; };" >> $lib.exp~
+      _LT_AC_TAGVAR(archive_expsym_cmds, $1)='$ECHO "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~$ECHO "local: *; };" >> $lib.exp~
   		$LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags~$rm $lib.exp'
       _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)=
       _LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=no

admin/ltmain.sh
===================================================================
--- parts/appwizard/common/admin/ltmain.sh	2007-12-01 00:39:20.000000000 +0200
+++ parts/appwizard/common/admin/ltmain.sh	2008-10-20 18:41:40.000000000 +0300
@@ -24,20 +24,27 @@
 # configuration script generated by Autoconf, you may include it under
 # the same distribution terms that you use for the rest of that program.
 
-# Check that we have a working $echo.
+# Check that we have a working $ECHO.
 if test "X$1" = X--no-reexec; then
   # Discard the --no-reexec flag, and continue.
   shift
 elif test "X$1" = X--fallback-echo; then
   # Avoid inline document here, it may be left over
   :
-elif test "X`($echo '\t') 2>/dev/null`" = 'X\t'; then
-  # Yippee, $echo works!
+elif test "X`($ECHO '\t') 2>/dev/null`" = 'X\t'; then
+  # Yippee, $ECHO works!
   :
 else
-  # Restart under the correct shell, and then maybe $echo will work.
+  # Restart under the correct shell, and then maybe $ECHO will work.
   exec $SHELL "$0" --no-reexec ${1+"$@"}
 fi
+# Same for EGREP, and just to be sure, do LTCC as well
+if test "x$EGREP" = x ; then
+    EGREP=egrep
+fi
+if test "x$LTCC" = x ; then
+    LTCC=${CC-gcc}
+fi
 
 if test "X$1" = X--fallback-echo; then
   # used as fallback echo
@@ -49,7 +56,7 @@
 fi
 
 # The name of this program.
-progname=`$echo "$0" | ${SED} 's%^.*/%%'`
+progname=`$ECHO "$0" | ${SED} 's%^.*/%%'`
 modename="$progname"
 
 # Constants.
@@ -97,8 +104,8 @@
 : ${IFS=" 	"}
 
 if test "$build_libtool_libs" != yes && test "$build_old_libs" != yes; then
-  $echo "$modename: not configured to build any kind of library" 1>&2
-  $echo "Fatal configuration error.  See the $PACKAGE docs for more information." 1>&2
+  $ECHO "$modename: not configured to build any kind of library" 1>&2
+  $ECHO "Fatal configuration error.  See the $PACKAGE docs for more information." 1>&2
   exit 1
 fi
 
@@ -108,12 +115,36 @@
 prev=
 prevopt=
 run=
-show="$echo"
+show="$ECHO"
 show_help=
 execute_dlfiles=
 lo2o="s/\\.lo\$/.${objext}/"
 o2lo="s/\\.${objext}\$/.lo/"
 
+if test -z "$max_cmd_len"; then
+  i=0
+  testring="ABCD"
+  new_result=
+  
+  # If test is not a shell built-in, we'll probably end up computing a
+  # maximum length that is only half of the actual maximum length, but
+  # we can't tell.
+  while (test "X"`$SHELL $0 --fallback-echo "X$testring" 2>/dev/null` \
+             = "XX$testring") >/dev/null 2>&1 &&
+          new_result=`expr "X$testring" : ".*" 2>&1` &&
+          max_cmd_len="$new_result" &&
+          test "$i" != 17 # 1/2 MB should be enough
+  do
+    i=`expr $i + 1`
+    testring="$testring$testring"
+  done
+  testring=
+  # Add a significant safety factor because C++ compilers can tack on massive
+  # amounts of additional arguments before passing them to the linker.
+  # It appears as though 1/2 is a usable value.
+  max_cmd_len=`expr $max_cmd_len \/ 2`
+fi
+
 #####################################
 # Shell function definitions:
 # This seems to be the best place for them
@@ -151,7 +182,7 @@
     esac
     ;;
   esac
-  $echo $win32_libid_type
+  $ECHO $win32_libid_type
 }
 
 # End of Shell function definitions
@@ -164,7 +195,7 @@
   shift
 
   case $arg in
-  -*=*) optarg=`$echo "X$arg" | $Xsed -e 's/[-_a-zA-Z0-9]*=//'` ;;
+  -*=*) optarg=`$ECHO "X$arg" | $Xsed -e 's/[-_a-zA-Z0-9]*=//'` ;;
   *) optarg= ;;
   esac
 
@@ -180,7 +211,7 @@
       # Check whether tagname contains only valid characters
       case $tagname in
       *[!-_A-Za-z0-9,/]*)
-	$echo "$progname: invalid tag name: $tagname" 1>&2
+	$ECHO "$progname: invalid tag name: $tagname" 1>&2
 	exit 1
 	;;
       esac
@@ -196,7 +227,7 @@
 	  # Evaluate the configuration.
 	  eval "`${SED} -n -e '/^# ### BEGIN LIBTOOL TAG CONFIG: '$tagname'$/,/^# ### END LIBTOOL TAG CONFIG: '$tagname'$/p' < $0`"
 	else
-	  $echo "$progname: ignoring unknown tag $tagname" 1>&2
+	  $ECHO "$progname: ignoring unknown tag $tagname" 1>&2
 	fi
 	;;
       esac
@@ -218,11 +249,11 @@
     ;;
 
   --version)
-    $echo "$PROGRAM (GNU $PACKAGE) $VERSION$TIMESTAMP"
-    $echo
-    $echo "Copyright (C) 2003  Free Software Foundation, Inc."
-    $echo "This is free software; see the source for copying conditions.  There is NO"
-    $echo "warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE."
+    $ECHO "$PROGRAM (GNU $PACKAGE) $VERSION$TIMESTAMP"
+    $ECHO
+    $ECHO "Copyright (C) 2003  Free Software Foundation, Inc."
+    $ECHO "This is free software; see the source for copying conditions.  There is NO"
+    $ECHO "warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE."
     exit 0
     ;;
 
@@ -236,7 +267,7 @@
     ;;
 
   --debug)
-    $echo "$progname: enabling shell trace mode"
+    $ECHO "$progname: enabling shell trace mode"
     set -x
     ;;
 
@@ -245,16 +276,16 @@
     ;;
 
   --features)
-    $echo "host: $host"
+    $ECHO "host: $host"
     if test "$build_libtool_libs" = yes; then
-      $echo "enable shared libraries"
+      $ECHO "enable shared libraries"
     else
-      $echo "disable shared libraries"
+      $ECHO "disable shared libraries"
     fi
     if test "$build_old_libs" = yes; then
-      $echo "enable static libraries"
+      $ECHO "enable static libraries"
     else
-      $echo "disable static libraries"
+      $ECHO "disable static libraries"
     fi
     exit 0
     ;;
@@ -283,8 +314,8 @@
     ;;
 
   -*)
-    $echo "$modename: unrecognized option \`$arg'" 1>&2
-    $echo "$help" 1>&2
+    $ECHO "$modename: unrecognized option \`$arg'" 1>&2
+    $ECHO "$help" 1>&2
     exit 1
     ;;
 
@@ -296,8 +327,8 @@
 done
 
 if test -n "$prevopt"; then
-  $echo "$modename: option \`$prevopt' requires an argument" 1>&2
-  $echo "$help" 1>&2
+  $ECHO "$modename: option \`$prevopt' requires an argument" 1>&2
+  $ECHO "$help" 1>&2
   exit 1
 fi
 
@@ -310,8 +341,8 @@
 
   # Infer the operation mode.
   if test -z "$mode"; then
-    $echo "*** Warning: inferring the mode of operation is deprecated." 1>&2
-    $echo "*** Future versions of Libtool will require -mode=MODE be specified." 1>&2
+    $ECHO "*** Warning: inferring the mode of operation is deprecated." 1>&2
+    $ECHO "*** Future versions of Libtool will require -mode=MODE be specified." 1>&2
     case $nonopt in
     *cc | cc* | *++ | gcc* | *-gcc* | g++* | xlc*)
       mode=link
@@ -341,9 +372,9 @@
       # Just use the default operation mode.
       if test -z "$mode"; then
 	if test -n "$nonopt"; then
-	  $echo "$modename: warning: cannot infer operation mode from \`$nonopt'" 1>&2
+	  $ECHO "$modename: warning: cannot infer operation mode from \`$nonopt'" 1>&2
 	else
-	  $echo "$modename: warning: cannot infer operation mode without MODE-ARGS" 1>&2
+	  $ECHO "$modename: warning: cannot infer operation mode without MODE-ARGS" 1>&2
 	fi
       fi
       ;;
@@ -352,8 +383,8 @@
 
   # Only execute mode is allowed to have -dlopen flags.
   if test -n "$execute_dlfiles" && test "$mode" != execute; then
-    $echo "$modename: unrecognized option \`-dlopen'" 1>&2
-    $echo "$help" 1>&2
+    $ECHO "$modename: unrecognized option \`-dlopen'" 1>&2
+    $ECHO "$help" 1>&2
     exit 1
   fi
 
@@ -393,7 +424,7 @@
 	case $arg in
 	-o)
 	  if test -n "$libobj" ; then
-	    $echo "$modename: you cannot specify \`-o' more than once" 1>&2
+	    $ECHO "$modename: you cannot specify \`-o' more than once" 1>&2
 	    exit 1
 	  fi
 	  arg_mode=target
@@ -421,7 +452,7 @@
 	  ;;            #  replaced later.  I would guess that would be a bug.
 
 	-Wc,*)
-	  args=`$echo "X$arg" | $Xsed -e "s/^-Wc,//"`
+	  args=`$ECHO "X$arg" | $Xsed -e "s/^-Wc,//"`
 	  lastarg=
 	  save_ifs="$IFS"; IFS=','
 	  for arg in $args; do
@@ -438,7 +469,7 @@
 	    lastarg="$lastarg $arg"
 	  done
 	  IFS="$save_ifs"
-	  lastarg=`$echo "X$lastarg" | $Xsed -e "s/^ //"`
+	  lastarg=`$ECHO "X$lastarg" | $Xsed -e "s/^ //"`
 
 	  # Add the arguments to base_compile.
 	  base_compile="$base_compile $lastarg"
@@ -457,7 +488,7 @@
       esac    #  case $arg_mode
 
       # Aesthetically quote the previous argument.
-      lastarg=`$echo "X$lastarg" | $Xsed -e "$sed_quote_subst"`
+      lastarg=`$ECHO "X$lastarg" | $Xsed -e "$sed_quote_subst"`
 
       case $lastarg in
       # Double-quote args containing other shell metacharacters.
@@ -473,16 +504,16 @@
 
     case $arg_mode in
     arg)
-      $echo "$modename: you must specify an argument for -Xcompile"
+      $ECHO "$modename: you must specify an argument for -Xcompile"
       exit 1
       ;;
     target)
-      $echo "$modename: you must specify a target with \`-o'" 1>&2
+      $ECHO "$modename: you must specify a target with \`-o'" 1>&2
       exit 1
       ;;
     *)
       # Get the name of the library object.
-      [ -z "$libobj" ] && libobj=`$echo "X$srcfile" | $Xsed -e 's%^.*/%%'`
+      [ -z "$libobj" ] && libobj=`$ECHO "X$srcfile" | $Xsed -e 's%^.*/%%'`
       ;;
     esac
 
@@ -505,12 +536,12 @@
     *.java) xform=java ;;
     esac
 
-    libobj=`$echo "X$libobj" | $Xsed -e "s/\.$xform$/.lo/"`
+    libobj=`$ECHO "X$libobj" | $Xsed -e "s/\.$xform$/.lo/"`
 
     case $libobj in
-    *.lo) obj=`$echo "X$libobj" | $Xsed -e "$lo2o"` ;;
+    *.lo) obj=`$ECHO "X$libobj" | $Xsed -e "$lo2o"` ;;
     *)
-      $echo "$modename: cannot determine name of library object from \`$libobj'" 1>&2
+      $ECHO "$modename: cannot determine name of library object from \`$libobj'" 1>&2
       exit 1
       ;;
     esac
@@ -523,7 +554,7 @@
       case $base_compile in
       # Blanks in the command may have been stripped by the calling shell,
       # but not from the CC environment variable when configure was run.
-      " $CC "* | "$CC "* | " `$echo $CC` "* | "`$echo $CC` "*) ;;
+      " $CC "* | "$CC "* | " `$ECHO $CC` "* | "`$ECHO $CC` "*) ;;
       # Blanks at the start of $base_compile will cause this to fail
       # if we don't check for them as well.
       *)
@@ -532,7 +563,7 @@
 	    # Evaluate the configuration.
 	    eval "`${SED} -n -e '/^# ### BEGIN LIBTOOL TAG CONFIG: '$z'$/,/^# ### END LIBTOOL TAG CONFIG: '$z'$/p' < $0`"
 	    case "$base_compile " in
-	    "$CC "* | " $CC "* | "`$echo $CC` "* | " `$echo $CC` "*)
+	    "$CC "* | " $CC "* | "`$ECHO $CC` "* | " `$ECHO $CC` "*)
 	      # The compiler in the base compile command matches
 	      # the one in the tagged configuration.
 	      # Assume this is the tagged configuration we want.
@@ -546,18 +577,18 @@
 	# was found and let the user know that the "--tag" command
 	# line option must be used.
 	if test -z "$tagname"; then
-	  $echo "$modename: unable to infer tagged configuration"
-	  $echo "$modename: specify a tag with \`--tag'" 1>&2
+	  $ECHO "$modename: unable to infer tagged configuration"
+	  $ECHO "$modename: specify a tag with \`--tag'" 1>&2
 	  exit 1
 #        else
-#          $echo "$modename: using $tagname tagged configuration"
+#          $ECHO "$modename: using $tagname tagged configuration"
 	fi
 	;;
       esac
     fi
 
-    objname=`$echo "X$obj" | $Xsed -e 's%^.*/%%'`
-    xdir=`$echo "X$obj" | $Xsed -e 's%/[^/]*$%%'`
+    objname=`$ECHO "X$obj" | $Xsed -e 's%^.*/%%'`
+    xdir=`$ECHO "X$obj" | $Xsed -e 's%/[^/]*$%%'`
     if test "X$xdir" = "X$obj"; then
       xdir=
     else
@@ -566,8 +597,8 @@
     lobj=${xdir}$objdir/$objname
 
     if test -z "$base_compile"; then
-      $echo "$modename: you must specify a compilation command" 1>&2
-      $echo "$help" 1>&2
+      $ECHO "$modename: you must specify a compilation command" 1>&2
+      $ECHO "$help" 1>&2
       exit 1
     fi
 
@@ -595,7 +626,7 @@
     # Calculate the filename of the output object if compiler does
     # not support -o with -c
     if test "$compiler_c_o" = no; then
-      output_obj=`$echo "X$srcfile" | $Xsed -e 's%^.*/%%' -e 's%\.[^.]*$%%'`.${objext}
+      output_obj=`$ECHO "X$srcfile" | $Xsed -e 's%^.*/%%' -e 's%\.[^.]*$%%'`.${objext}
       lockfile="$output_obj.lock"
       removelist="$removelist $output_obj $lockfile"
       trap "$run $rm $removelist; exit 1" 1 2 15
@@ -614,7 +645,7 @@
       done
     elif test "$need_locks" = warn; then
       if test -f "$lockfile"; then
-	$echo "\
+	$ECHO "\
 *** ERROR, $lockfile exists and contains:
 `cat $lockfile 2>/dev/null`
 
@@ -628,7 +659,7 @@
 	$run $rm $removelist
 	exit 1
       fi
-      $echo $srcfile > "$lockfile"
+      $ECHO $srcfile > "$lockfile"
     fi
 
     if test -n "$fix_srcfile_path"; then
@@ -686,7 +717,7 @@
 
       if test "$need_locks" = warn &&
 	 test "X`cat $lockfile 2>/dev/null`" != "X$srcfile"; then
-	$echo "\
+	$ECHO "\
 *** ERROR, $lockfile contains:
 `cat $lockfile 2>/dev/null`
 
@@ -756,7 +787,7 @@
 
       if test "$need_locks" = warn &&
 	 test "X`cat $lockfile 2>/dev/null`" != "X$srcfile"; then
-	$echo "\
+	$ECHO "\
 *** ERROR, $lockfile contains:
 `cat $lockfile 2>/dev/null`
 
@@ -888,7 +919,7 @@
       -all-static | -static)
 	if test "X$arg" = "X-all-static"; then
 	  if test "$build_libtool_libs" = yes && test -z "$link_static_flag"; then
-	    $echo "$modename: warning: complete static linking is impossible in this configuration" 1>&2
+	    $ECHO "$modename: warning: complete static linking is impossible in this configuration" 1>&2
 	  fi
 	  if test -n "$link_static_flag"; then
 	    dlopen_self=$dlopen_self_static
@@ -916,7 +947,7 @@
       shift
       case $arg in
       *[\[\~\#\^\&\*\(\)\{\}\|\;\<\>\?\'\ \	]*|*]*|"")
-	qarg=\"`$echo "X$arg" | $Xsed -e "$sed_quote_subst"`\" ### testsuite: skip nested quoting test
+	qarg=\"`$ECHO "X$arg" | $Xsed -e "$sed_quote_subst"`\" ### testsuite: skip nested quoting test
 	;;
       *) qarg=$arg ;;
       esac
@@ -975,7 +1006,7 @@
 	expsyms)
 	  export_symbols="$arg"
 	  if test ! -f "$arg"; then
-	    $echo "$modename: symbol file \`$arg' does not exist"
+	    $ECHO "$modename: symbol file \`$arg' does not exist"
 	    exit 1
 	  fi
 	  prev=
@@ -1022,12 +1053,12 @@
 		   test -z "$non_pic_object" ||
 		   test "$pic_object" = none && \
 		   test "$non_pic_object" = none; then
-		  $echo "$modename: cannot find name of object for \`$arg'" 1>&2
+		  $ECHO "$modename: cannot find name of object for \`$arg'" 1>&2
 		  exit 1
 		fi
 
 		# Extract subdirectory from the argument.
-		xdir=`$echo "X$arg" | $Xsed -e 's%/[^/]*$%%'`
+		xdir=`$ECHO "X$arg" | $Xsed -e 's%/[^/]*$%%'`
 		if test "X$xdir" = "X$arg"; then
 		  xdir=
 		else
@@ -1075,28 +1106,28 @@
 	      else
 		# Only an error if not doing a dry-run.
 		if test -z "$run"; then
-		  $echo "$modename: \`$arg' is not a valid libtool object" 1>&2
+		  $ECHO "$modename: \`$arg' is not a valid libtool object" 1>&2
 		  exit 1
 		else
 		  # Dry-run case.
 
 		  # Extract subdirectory from the argument.
-		  xdir=`$echo "X$arg" | $Xsed -e 's%/[^/]*$%%'`
+		  xdir=`$ECHO "X$arg" | $Xsed -e 's%/[^/]*$%%'`
 		  if test "X$xdir" = "X$arg"; then
 		    xdir=
 		  else
 		    xdir="$xdir/"
 		  fi
 
-		  pic_object=`$echo "X${xdir}${objdir}/${arg}" | $Xsed -e "$lo2o"`
-		  non_pic_object=`$echo "X${xdir}${arg}" | $Xsed -e "$lo2o"`
+		  pic_object=`$ECHO "X${xdir}${objdir}/${arg}" | $Xsed -e "$lo2o"`
+		  non_pic_object=`$ECHO "X${xdir}${arg}" | $Xsed -e "$lo2o"`
 		  libobjs="$libobjs $pic_object"
 		  non_pic_objects="$non_pic_objects $non_pic_object"
 		fi
 	      fi
 	    done
 	  else
-	    $echo "$modename: link input file \`$save_arg' does not exist"
+	    $ECHO "$modename: link input file \`$save_arg' does not exist"
 	    exit 1
 	  fi
 	  arg=$save_arg
@@ -1108,7 +1139,7 @@
 	  case $arg in
 	  [\\/]* | [A-Za-z]:[\\/]*) ;;
 	  *)
-	    $echo "$modename: only absolute run-paths are allowed" 1>&2
+	    $ECHO "$modename: only absolute run-paths are allowed" 1>&2
 	    exit 1
 	    ;;
 	  esac
@@ -1183,7 +1214,7 @@
 
       -allow-undefined)
 	# FIXME: remove this flag sometime in the future.
-	$echo "$modename: \`-allow-undefined' is deprecated because it is the default" 1>&2
+	$ECHO "$modename: \`-allow-undefined' is deprecated because it is the default" 1>&2
 	continue
 	;;
 
@@ -1209,7 +1240,7 @@
 
       -export-symbols | -export-symbols-regex)
 	if test -n "$export_symbols" || test -n "$export_symbols_regex"; then
-	  $echo "$modename: more than one -exported-symbols argument is not allowed"
+	  $ECHO "$modename: more than one -exported-symbols argument is not allowed"
 	  exit 1
 	fi
 	if test "X$arg" = "X-export-symbols"; then
@@ -1238,14 +1269,14 @@
 	;;
 
       -L*)
-	dir=`$echo "X$arg" | $Xsed -e 's/^-L//'`
+	dir=`$ECHO "X$arg" | $Xsed -e 's/^-L//'`
 	# We need an absolute path.
 	case $dir in
 	[\\/]* | [A-Za-z]:[\\/]*) ;;
 	*)
 	  absdir=`cd "$dir" && pwd`
 	  if test -z "$absdir"; then
-	    $echo "$modename: cannot determine absolute directory name of \`$dir'" 1>&2
+	    $ECHO "$modename: cannot determine absolute directory name of \`$dir'" 1>&2
 	    exit 1
 	  fi
 	  dir="$absdir"
@@ -1315,7 +1346,7 @@
       -m*)
 	# Unknown arguments in both finalize_command and compile_command need
 	# to be aesthetically quoted because they are evaled later.
-	arg=`$echo "X$arg" | $Xsed -e "$sed_quote_subst"`
+	arg=`$ECHO "X$arg" | $Xsed -e "$sed_quote_subst"`
 	case $arg in
 	*[\[\~\#\^\&\*\(\)\{\}\|\;\<\>\?\'\ \	]*|*]*|"")
 	  arg="\"$arg\""
@@ -1344,8 +1375,8 @@
 	*-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2*)
 	  # The PATH hackery in wrapper scripts is required on Windows
 	  # in order for the loader to find any dlls it needs.
-	  $echo "$modename: warning: \`-no-install' is ignored for $host" 1>&2
-	  $echo "$modename: warning: assuming \`-no-fast-install' instead" 1>&2
+	  $ECHO "$modename: warning: \`-no-install' is ignored for $host" 1>&2
+	  $ECHO "$modename: warning: assuming \`-no-fast-install' instead" 1>&2
 	  fast_install=no
 	  ;;
 	*) no_install=yes ;;
@@ -1381,12 +1412,12 @@
 	;;
 
       -R*)
-	dir=`$echo "X$arg" | $Xsed -e 's/^-R//'`
+	dir=`$ECHO "X$arg" | $Xsed -e 's/^-R//'`
 	# We need an absolute path.
 	case $dir in
 	[\\/]* | [A-Za-z]:[\\/]*) ;;
 	*)
-	  $echo "$modename: only absolute run-paths are allowed" 1>&2
+	  $ECHO "$modename: only absolute run-paths are allowed" 1>&2
 	  exit 1
 	  ;;
 	esac
@@ -1422,7 +1453,7 @@
 	;;
 
       -Wc,*)
-	args=`$echo "X$arg" | $Xsed -e "$sed_quote_subst" -e 's/^-Wc,//'`
+	args=`$ECHO "X$arg" | $Xsed -e "$sed_quote_subst" -e 's/^-Wc,//'`
 	arg=
 	save_ifs="$IFS"; IFS=','
 	for flag in $args; do
@@ -1436,11 +1467,11 @@
 	  compiler_flags="$compiler_flags $flag"
 	done
 	IFS="$save_ifs"
-	arg=`$echo "X$arg" | $Xsed -e "s/^ //"`
+	arg=`$ECHO "X$arg" | $Xsed -e "s/^ //"`
 	;;
 
       -Wl,*)
-	args=`$echo "X$arg" | $Xsed -e "$sed_quote_subst" -e 's/^-Wl,//'`
+	args=`$ECHO "X$arg" | $Xsed -e "$sed_quote_subst" -e 's/^-Wl,//'`
 	arg=
 	save_ifs="$IFS"; IFS=','
 	for flag in $args; do
@@ -1455,7 +1486,7 @@
 	  linker_flags="$linker_flags $flag"
 	done
 	IFS="$save_ifs"
-	arg=`$echo "X$arg" | $Xsed -e "s/^ //"`
+	arg=`$ECHO "X$arg" | $Xsed -e "s/^ //"`
 	;;
 
       -Xcompiler)
@@ -1482,7 +1513,7 @@
       -* | +*)
 	# Unknown arguments in both finalize_command and compile_command need
 	# to be aesthetically quoted because they are evaled later.
-	arg=`$echo "X$arg" | $Xsed -e "$sed_quote_subst"`
+	arg=`$ECHO "X$arg" | $Xsed -e "$sed_quote_subst"`
 	case $arg in
 	*[\[\~\#\^\&\*\(\)\{\}\|\;\<\>\?\'\ \	]*|*]*|"")
 	  arg="\"$arg\""
@@ -1515,12 +1546,12 @@
 	     test -z "$non_pic_object" ||
 	     test "$pic_object" = none && \
 	     test "$non_pic_object" = none; then
-	    $echo "$modename: cannot find name of object for \`$arg'" 1>&2
+	    $ECHO "$modename: cannot find name of object for \`$arg'" 1>&2
 	    exit 1
 	  fi
 
 	  # Extract subdirectory from the argument.
-	  xdir=`$echo "X$arg" | $Xsed -e 's%/[^/]*$%%'`
+	  xdir=`$ECHO "X$arg" | $Xsed -e 's%/[^/]*$%%'`
 	  if test "X$xdir" = "X$arg"; then
 	    xdir=
  	  else
@@ -1568,21 +1599,21 @@
 	else
 	  # Only an error if not doing a dry-run.
 	  if test -z "$run"; then
-	    $echo "$modename: \`$arg' is not a valid libtool object" 1>&2
+	    $ECHO "$modename: \`$arg' is not a valid libtool object" 1>&2
 	    exit 1
 	  else
 	    # Dry-run case.
 
 	    # Extract subdirectory from the argument.
-	    xdir=`$echo "X$arg" | $Xsed -e 's%/[^/]*$%%'`
+	    xdir=`$ECHO "X$arg" | $Xsed -e 's%/[^/]*$%%'`
 	    if test "X$xdir" = "X$arg"; then
 	      xdir=
 	    else
 	      xdir="$xdir/"
 	    fi
 
-	    pic_object=`$echo "X${xdir}${objdir}/${arg}" | $Xsed -e "$lo2o"`
-	    non_pic_object=`$echo "X${xdir}${arg}" | $Xsed -e "$lo2o"`
+	    pic_object=`$ECHO "X${xdir}${objdir}/${arg}" | $Xsed -e "$lo2o"`
+	    non_pic_object=`$ECHO "X${xdir}${arg}" | $Xsed -e "$lo2o"`
 	    libobjs="$libobjs $pic_object"
 	    non_pic_objects="$non_pic_objects $non_pic_object"
 	  fi
@@ -1617,7 +1648,7 @@
       *)
 	# Unknown arguments in both finalize_command and compile_command need
 	# to be aesthetically quoted because they are evaled later.
-	arg=`$echo "X$arg" | $Xsed -e "$sed_quote_subst"`
+	arg=`$ECHO "X$arg" | $Xsed -e "$sed_quote_subst"`
 	case $arg in
 	*[\[\~\#\^\&\*\(\)\{\}\|\;\<\>\?\'\ \	]*|*]*|"")
 	  arg="\"$arg\""
@@ -1635,8 +1666,8 @@
     done # argument parsing loop
 
     if test -n "$prev"; then
-      $echo "$modename: the \`$prevarg' option requires an argument" 1>&2
-      $echo "$help" 1>&2
+      $ECHO "$modename: the \`$prevarg' option requires an argument" 1>&2
+      $ECHO "$help" 1>&2
       exit 1
     fi
 
@@ -1648,7 +1679,7 @@
       case $base_compile in
       # Blanks in the command may have been stripped by the calling shell,
       # but not from the CC environment variable when configure was run.
-      "$CC "* | " $CC "* | "`$echo $CC` "* | " `$echo $CC` "*) ;;
+      "$CC "* | " $CC "* | "`$ECHO $CC` "* | " `$ECHO $CC` "*) ;;
       # Blanks at the start of $base_compile will cause this to fail
       # if we don't check for them as well.
       *)
@@ -1657,7 +1688,7 @@
 	    # Evaluate the configuration.
 	    eval "`${SED} -n -e '/^# ### BEGIN LIBTOOL TAG CONFIG: '$z'$/,/^# ### END LIBTOOL TAG CONFIG: '$z'$/p' < $0`"
 	    case $base_compile in
-	    "$CC "* | " $CC "* | "`$echo $CC` "* | " `$echo $CC` "*)
+	    "$CC "* | " $CC "* | "`$ECHO $CC` "* | " `$ECHO $CC` "*)
 	      # The compiler in $compile_command matches
 	      # the one in the tagged configuration.
 	      # Assume this is the tagged configuration we want.
@@ -1671,11 +1702,11 @@
 	# was found and let the user know that the "--tag" command
 	# line option must be used.
 	if test -z "$tagname"; then
-	  $echo "$modename: unable to infer tagged configuration"
-	  $echo "$modename: specify a tag with \`--tag'" 1>&2
+	  $ECHO "$modename: unable to infer tagged configuration"
+	  $ECHO "$modename: specify a tag with \`--tag'" 1>&2
 	  exit 1
 #       else
-#         $echo "$modename: using $tagname tagged configuration"
+#         $ECHO "$modename: using $tagname tagged configuration"
 	fi
 	;;
       esac
@@ -1689,19 +1720,19 @@
 
     oldlibs=
     # calculate the name of the file, without its directory
-    outputname=`$echo "X$output" | $Xsed -e 's%^.*/%%'`
+    outputname=`$ECHO "X$output" | $Xsed -e 's%^.*/%%'`
     libobjs_save="$libobjs"
 
     if test -n "$shlibpath_var"; then
       # get the directories listed in $shlibpath_var
-      eval shlib_search_path=\`\$echo \"X\${$shlibpath_var}\" \| \$Xsed -e \'s/:/ /g\'\`
+      eval shlib_search_path=\`\$ECHO \"X\${$shlibpath_var}\" \| \$Xsed -e \'s/:/ /g\'\`
     else
       shlib_search_path=
     fi
     eval sys_lib_search_path=\"$sys_lib_search_path_spec\"
     eval sys_lib_dlsearch_path=\"$sys_lib_dlsearch_path_spec\"
 
-    output_objdir=`$echo "X$output" | $Xsed -e 's%/[^/]*$%%'`
+    output_objdir=`$ECHO "X$output" | $Xsed -e 's%/[^/]*$%%'`
     if test "X$output_objdir" = "X$output"; then
       output_objdir="$objdir"
     else
@@ -1720,8 +1751,8 @@
     # Determine the type of output
     case $output in
     "")
-      $echo "$modename: you must specify an output file" 1>&2
-      $echo "$help" 1>&2
+      $ECHO "$modename: you must specify an output file" 1>&2
+      $ECHO "$help" 1>&2
       exit 1
       ;;
     *.$libext) linkmode=oldlib ;;
@@ -1784,7 +1815,7 @@
 	  case $file in
 	  *.la) ;;
 	  *)
-	    $echo "$modename: libraries can \`-dlopen' only libtool libraries: $file" 1>&2
+	    $ECHO "$modename: libraries can \`-dlopen' only libtool libraries: $file" 1>&2
 	    exit 1
 	    ;;
 	  esac
@@ -1823,16 +1854,25 @@
 	lib=
 	found=no
 	case $deplib in
+	-mt|-mthreads|-kthread|-Kthread|-pthread|-pthreads|--thread-safe)
+	  if test "$linkmode,$pass" = "prog,link"; then
+	    compile_deplibs="$deplib $compile_deplibs"
+	    finalize_deplibs="$deplib $finalize_deplibs"
+	  else
+	    deplibs="$deplib $deplibs"
+	  fi
+	  continue
+	  ;;
 	-l*)
 	  if test "$linkmode" != lib && test "$linkmode" != prog; then
-	    $echo "$modename: warning: \`-l' is ignored for archives/objects" 1>&2
+	    $ECHO "$modename: warning: \`-l' is ignored for archives/objects" 1>&2
 	    continue
 	  fi
 	  if test "$pass" = conv && test "$allow_undefined" = yes; then
 	    deplibs="$deplib $deplibs"
 	    continue
 	  fi
-	  name=`$echo "X$deplib" | $Xsed -e 's/^-l//'`
+	  name=`$ECHO "X$deplib" | $Xsed -e 's/^-l//'`
 	  for searchdir in $newlib_search_path $lib_search_path $sys_lib_search_path $shlib_search_path; do
 	    for search_ext in .la $shrext .so .a; do
 	      # Search the libtool library
@@ -1876,7 +1916,7 @@
 		  done
 		  if test "X$ll" = "X$old_library" ; then # only static version available
 		    found=no
-		    ladir=`$echo "X$lib" | $Xsed -e 's%/[^/]*$%%'`
+		    ladir=`$ECHO "X$lib" | $Xsed -e 's%/[^/]*$%%'`
 		    test "X$ladir" = "X$lib" && ladir="."
 		    lib=$ladir/$old_library
 		    if test "$linkmode,$pass" = "prog,link"; then
@@ -1913,7 +1953,7 @@
 	    deplibs="$deplib $deplibs"
 	    test "$pass" = conv && continue
 	    newdependency_libs="$deplib $newdependency_libs"
-	    newlib_search_path="$newlib_search_path "`$echo "X$deplib" | $Xsed -e 's/^-L//'`
+	    newlib_search_path="$newlib_search_path "`$ECHO "X$deplib" | $Xsed -e 's/^-L//'`
 	    ;;
 	  prog)
 	    if test "$pass" = conv; then
@@ -1922,21 +1962,21 @@
 	    fi
 	    if test "$pass" = scan; then
 	      deplibs="$deplib $deplibs"
-	      newlib_search_path="$newlib_search_path "`$echo "X$deplib" | $Xsed -e 's/^-L//'`
+	      newlib_search_path="$newlib_search_path "`$ECHO "X$deplib" | $Xsed -e 's/^-L//'`
 	    else
 	      compile_deplibs="$deplib $compile_deplibs"
 	      finalize_deplibs="$deplib $finalize_deplibs"
 	    fi
 	    ;;
 	  *)
-	    $echo "$modename: warning: \`-L' is ignored for archives/objects" 1>&2
+	    $ECHO "$modename: warning: \`-L' is ignored for archives/objects" 1>&2
 	    ;;
 	  esac # linkmode
 	  continue
 	  ;; # -L
 	-R*)
 	  if test "$pass" = link; then
-	    dir=`$echo "X$deplib" | $Xsed -e 's/^-R//'`
+	    dir=`$ECHO "X$deplib" | $Xsed -e 's/^-R//'`
 	    # Make sure the xrpath contains only unique directories.
 	    case "$xrpath " in
 	    *" $dir "*) ;;
@@ -1955,17 +1995,17 @@
 	  case $linkmode in
 	  lib)
 	    if test "$deplibs_check_method" != pass_all; then
-	      $echo
-	      $echo "*** Warning: Trying to link with static lib archive $deplib."
-	      $echo "*** I have the capability to make that library automatically link in when"
-	      $echo "*** you link to this library.  But I can only do this if you have a"
-	      $echo "*** shared version of the library, which you do not appear to have"
-	      $echo "*** because the file extensions .$libext of this argument makes me believe"
-	      $echo "*** that it is just a static archive that I should not used here."
+	      $ECHO
+	      $ECHO "*** Warning: Trying to link with static lib archive $deplib."
+	      $ECHO "*** I have the capability to make that library automatically link in when"
+	      $ECHO "*** you link to this library.  But I can only do this if you have a"
+	      $ECHO "*** shared version of the library, which you do not appear to have"
+	      $ECHO "*** because the file extensions .$libext of this argument makes me believe"
+	      $ECHO "*** that it is just a static archive that I should not used here."
 	    else
-	      $echo
-	      $echo "*** Warning: Linking the shared library $output against the"
-	      $echo "*** static library $deplib is not portable!"
+	      $ECHO
+	      $ECHO "*** Warning: Linking the shared library $output against the"
+	      $ECHO "*** static library $deplib is not portable!"
 	      deplibs="$deplib $deplibs"
 	    fi
 	    continue
@@ -2004,18 +2044,18 @@
 	esac # case $deplib
 	if test "$found" = yes || test -f "$lib"; then :
 	else
-	  $echo "$modename: cannot find the library \`$lib'" 1>&2
+	  $ECHO "$modename: cannot find the library \`$lib'" 1>&2
 	  exit 1
 	fi
 
 	# Check to see that this really is a libtool archive.
 	if (${SED} -e '2q' $lib | grep "^# Generated by .*$PACKAGE") >/dev/null 2>&1; then :
 	else
-	  $echo "$modename: \`$lib' is not a valid libtool archive" 1>&2
+	  $ECHO "$modename: \`$lib' is not a valid libtool archive" 1>&2
 	  exit 1
 	fi
 
-	ladir=`$echo "X$lib" | $Xsed -e 's%/[^/]*$%%'`
+	ladir=`$ECHO "X$lib" | $Xsed -e 's%/[^/]*$%%'`
 	test "X$ladir" = "X$lib" && ladir="."
 
 	dlname=
@@ -2038,7 +2078,7 @@
 	case $host in
 	*-*-darwin*)
 	  # Convert "-framework foo" to "foo.ltframework" in dependency_libs
-	  test -n "$dependency_libs" && dependency_libs=`$echo "X$dependency_libs" | $Xsed -e 's/-framework \([^ $]*\)/\1.ltframework/g'`
+	  test -n "$dependency_libs" && dependency_libs=`$ECHO "X$dependency_libs" | $Xsed -e 's/-framework \([^ $]*\)/\1.ltframework/g'`
 	  ;;
 	esac
 
@@ -2065,14 +2105,14 @@
 	  done
 	  if test -z "$libdir"; then
 	    if test -z "$old_library"; then
-	      $echo "$modename: cannot find name of link library for \`$lib'" 1>&2
+	      $ECHO "$modename: cannot find name of link library for \`$lib'" 1>&2
 	      exit 1
 	    fi
 	    # It is a libtool convenience library, so add in its objects.
 	    convenience="$convenience $ladir/$objdir/$old_library"
 	    old_convenience="$old_convenience $ladir/$objdir/$old_library"
 	  elif test "$linkmode" != prog && test "$linkmode" != lib; then
-	    $echo "$modename: \`$lib' is not a convenience library" 1>&2
+	    $ECHO "$modename: \`$lib' is not a convenience library" 1>&2
 	    exit 1
 	  fi
 	  continue
@@ -2085,14 +2125,14 @@
 	  linklib="$l"
 	done
 	if test -z "$linklib"; then
-	  $echo "$modename: cannot find name of link library for \`$lib'" 1>&2
+	  $ECHO "$modename: cannot find name of link library for \`$lib'" 1>&2
 	  exit 1
 	fi
 
 	# This library was specified with -dlopen.
 	if test "$pass" = dlopen; then
 	  if test -z "$libdir"; then
-	    $echo "$modename: cannot -dlopen a convenience library: \`$lib'" 1>&2
+	    $ECHO "$modename: cannot -dlopen a convenience library: \`$lib'" 1>&2
 	    exit 1
 	  fi
 	  if test -z "$dlname" || test "$dlopen_support" != yes || test "$build_libtool_libs" = no; then
@@ -2113,18 +2153,18 @@
 	*)
 	  abs_ladir=`cd "$ladir" && pwd`
 	  if test -z "$abs_ladir"; then
-	    $echo "$modename: warning: cannot determine absolute directory name of \`$ladir'" 1>&2
-	    $echo "$modename: passing it literally to the linker, although it might fail" 1>&2
+	    $ECHO "$modename: warning: cannot determine absolute directory name of \`$ladir'" 1>&2
+	    $ECHO "$modename: passing it literally to the linker, although it might fail" 1>&2
 	    abs_ladir="$ladir"
 	  fi
 	  ;;
 	esac
-	laname=`$echo "X$lib" | $Xsed -e 's%^.*/%%'`
+	laname=`$ECHO "X$lib" | $Xsed -e 's%^.*/%%'`
 
 	# Find the relevant object directory and library name.
 	if test "X$installed" = Xyes; then
 	  if test ! -f "$libdir/$linklib" && test -f "$abs_ladir/$linklib"; then
-	    $echo "$modename: warning: library \`$lib' was moved." 1>&2
+	    $ECHO "$modename: warning: library \`$lib' was moved." 1>&2
 	    dir="$ladir"
 	    absdir="$abs_ladir"
 	    libdir="$abs_ladir"
@@ -2138,12 +2178,12 @@
 	  # Remove this search path later
 	  notinst_path="$notinst_path $abs_ladir"
 	fi # $installed = yes
-	name=`$echo "X$laname" | $Xsed -e 's/\.la$//' -e 's/^lib//'`
+	name=`$ECHO "X$laname" | $Xsed -e 's/\.la$//' -e 's/^lib//'`
 
 	# This library was specified with -dlpreopen.
 	if test "$pass" = dlpreopen; then
 	  if test -z "$libdir"; then
-	    $echo "$modename: cannot -dlpreopen a convenience library: \`$lib'" 1>&2
+	    $ECHO "$modename: cannot -dlpreopen a convenience library: \`$lib'" 1>&2
 	    exit 1
 	  fi
 	  # Prefer using a static library (so that no silly _DYNAMIC symbols
@@ -2185,7 +2225,7 @@
 	  tmp_libs=
 	  for deplib in $dependency_libs; do
 	    case $deplib in
-	    -L*) newlib_search_path="$newlib_search_path "`$echo "X$deplib" | $Xsed -e 's/^-L//'`;; ### testsuite: skip nested quoting test
+	    -L*) newlib_search_path="$newlib_search_path "`$ECHO "X$deplib" | $Xsed -e 's/^-L//'`;; ### testsuite: skip nested quoting test
 	    esac
 	    # Need to link against all dependency_libs?
 	    if test "$linkalldeplibs" = yes; then
@@ -2261,13 +2301,13 @@
 	
       # Warn about portability, can't link against -module's on some systems (darwin)
       if test "$shouldnotlink" = yes && test "$pass" = link ; then
-	    $echo
+	    $ECHO
 	    if test "$linkmode" = prog; then
-	      $echo "*** Warning: Linking the executable $output against the loadable module"
+	      $ECHO "*** Warning: Linking the executable $output against the loadable module"
 	    else
-	      $echo "*** Warning: Linking the shared library $output against the loadable module"
+	      $ECHO "*** Warning: Linking the shared library $output against the loadable module"
 	    fi
-	    $echo "*** $linklib is not portable!"    
+	    $ECHO "*** $linklib is not portable!"    
       fi	  
 	  if test "$linkmode" = lib &&
 	     test "$hardcode_into_libs" = yes; then
@@ -2299,7 +2339,7 @@
 	    set dummy $library_names
 	    realname="$2"
 	    shift; shift
-	    libname=`eval \\$echo \"$libname_spec\"`
+	    libname=`eval \\$ECHO \"$libname_spec\"`
 	    # use dlname if we got it. it's perfectly good, no?
 	    if test -n "$dlname"; then
 	      soname="$dlname"
@@ -2318,8 +2358,8 @@
 
 	    # Make a new name for the extract_expsyms_cmds to use
 	    soroot="$soname"
-	    soname=`$echo $soroot | ${SED} -e 's/^.*\///'`
-	    newlib="libimp-`$echo $soname | ${SED} 's/^lib//;s/\.dll$//'`.a"
+	    soname=`$ECHO $soroot | ${SED} -e 's/^.*\///'`
+	    newlib="libimp-`$ECHO $soname | ${SED} 's/^lib//;s/\.dll$//'`.a"
 
 	    # If the library has no export list, then create one now
 	    if test -f "$output_objdir/$soname-def"; then :
@@ -2367,11 +2407,11 @@
 		    # if the lib is a module then we can not link against it, someone
 		    # is ignoring the new warnings I added
 		    if /usr/bin/file -L $add 2> /dev/null | grep "bundle" >/dev/null ; then
-		      $echo "** Warning, lib $linklib is a module, not a shared library"
+		      $ECHO "** Warning, lib $linklib is a module, not a shared library"
 		      if test -z "$old_library" ; then
-		        $echo
-		        $echo "** And there doesn't seem to be a static archive available"
-		        $echo "** The link will probably fail, sorry"
+		        $ECHO
+		        $ECHO "** And there doesn't seem to be a static archive available"
+		        $ECHO "** The link will probably fail, sorry"
 		      else
 		        add="$dir/$old_library"
 		      fi 
@@ -2415,7 +2455,7 @@
 	    esac
 
 	    if test "$lib_linked" != yes; then
-	      $echo "$modename: configuration error: unsupported hardcode properties"
+	      $ECHO "$modename: configuration error: unsupported hardcode properties"
 	      exit 1
 	    fi
 
@@ -2506,21 +2546,21 @@
 
 	    # Just print a warning and add the library to dependency_libs so
 	    # that the program can be linked against the static library.
-	    $echo
-	    $echo "*** Warning: This system can not link to static lib archive $lib."
-	    $echo "*** I have the capability to make that library automatically link in when"
-	    $echo "*** you link to this library.  But I can only do this if you have a"
-	    $echo "*** shared version of the library, which you do not appear to have."
+	    $ECHO
+	    $ECHO "*** Warning: This system can not link to static lib archive $lib."
+	    $ECHO "*** I have the capability to make that library automatically link in when"
+	    $ECHO "*** you link to this library.  But I can only do this if you have a"
+	    $ECHO "*** shared version of the library, which you do not appear to have."
 	    if test "$module" = yes; then
-	      $echo "*** But as you try to build a module library, libtool will still create "
-	      $echo "*** a static module, that should work as long as the dlopening application"
-	      $echo "*** is linked with the -dlopen flag to resolve symbols at runtime."
+	      $ECHO "*** But as you try to build a module library, libtool will still create "
+	      $ECHO "*** a static module, that should work as long as the dlopening application"
+	      $ECHO "*** is linked with the -dlopen flag to resolve symbols at runtime."
 	      if test -z "$global_symbol_pipe"; then
-		$echo
-		$echo "*** However, this would only work if libtool was able to extract symbol"
-		$echo "*** lists from a program, using \`nm' or equivalent, but libtool could"
-		$echo "*** not find such a program.  So, this module is probably useless."
-		$echo "*** \`nm' from GNU binutils and a full rebuild may help."
+		$ECHO
+		$ECHO "*** However, this would only work if libtool was able to extract symbol"
+		$ECHO "*** lists from a program, using \`nm' or equivalent, but libtool could"
+		$ECHO "*** not find such a program.  So, this module is probably useless."
+		$ECHO "*** \`nm' from GNU binutils and a full rebuild may help."
 	      fi
 	      if test "$build_old_libs" = no; then
 		build_libtool_libs=module
@@ -2545,7 +2585,7 @@
 	    temp_deplibs=
 	    for libdir in $dependency_libs; do
 	      case $libdir in
-	      -R*) temp_xrpath=`$echo "X$libdir" | $Xsed -e 's/^-R//'`
+	      -R*) temp_xrpath=`$ECHO "X$libdir" | $Xsed -e 's/^-R//'`
 		   case " $xrpath " in
 		   *" $temp_xrpath "*) ;;
 		   *) xrpath="$xrpath $temp_xrpath";;
@@ -2577,7 +2617,7 @@
 	      case $deplib in
 	      -L*) path="$deplib" ;;
 	      *.la)
-		dir=`$echo "X$deplib" | $Xsed -e 's%/[^/]*$%%'`
+		dir=`$ECHO "X$deplib" | $Xsed -e 's%/[^/]*$%%'`
 		test "X$dir" = "X$deplib" && dir="."
 		# We need an absolute path.
 		case $dir in
@@ -2585,7 +2625,7 @@
 		*)
 		  absdir=`cd "$dir" && pwd`
 		  if test -z "$absdir"; then
-		    $echo "$modename: warning: cannot determine absolute directory name of \`$dir'" 1>&2
+		    $ECHO "$modename: warning: cannot determine absolute directory name of \`$dir'" 1>&2
 		    absdir="$dir"
 		  fi
 		  ;;
@@ -2595,14 +2635,14 @@
 		else
 		  eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $deplib`
 		  if test -z "$libdir"; then
-		    $echo "$modename: \`$deplib' is not a valid libtool archive" 1>&2
+		    $ECHO "$modename: \`$deplib' is not a valid libtool archive" 1>&2
 		    exit 1
 		  fi
 		  if test "$absdir" != "$libdir"; then
 		    # Sure, some shells/systems don't implement the -ef.
 		    # Those will have to live with the warning.
 		    test "$absdir" -ef "$libdir" > /dev/null 2>&1 ||
-		      $echo "$modename: warning: \`$deplib' seems to be moved" 1>&2
+		      $ECHO "$modename: warning: \`$deplib' seems to be moved" 1>&2
 		  fi
 		  path="$absdir"
 		fi
@@ -2636,7 +2676,7 @@
 		case $host in
 		*-*-darwin*)
 		 # Again, we only want to link against shared libraries
-		 eval tmp_libs=`$echo "X$deplib" | $Xsed -e "s,^\-l,,"`
+		 eval tmp_libs=`$ECHO "X$deplib" | $Xsed -e "s,^\-l,,"`
 		 for tmp in $newlib_search_path ; do
 		     if test -f "$tmp/lib$tmp_libs.dylib" ; then
 		       eval depdepl="$tmp/lib$tmp_libs.dylib"
@@ -2774,31 +2814,31 @@
     case $linkmode in
     oldlib)
       if test -n "$deplibs"; then
-	$echo "$modename: warning: \`-l' and \`-L' are ignored for archives" 1>&2
+	$ECHO "$modename: warning: \`-l' and \`-L' are ignored for archives" 1>&2
       fi
 
       if test -n "$dlfiles$dlprefiles" || test "$dlself" != no; then
-	$echo "$modename: warning: \`-dlopen' is ignored for archives" 1>&2
+	$ECHO "$modename: warning: \`-dlopen' is ignored for archives" 1>&2
       fi
 
       if test -n "$rpath"; then
-	$echo "$modename: warning: \`-rpath' is ignored for archives" 1>&2
+	$ECHO "$modename: warning: \`-rpath' is ignored for archives" 1>&2
       fi
 
       if test -n "$xrpath"; then
-	$echo "$modename: warning: \`-R' is ignored for archives" 1>&2
+	$ECHO "$modename: warning: \`-R' is ignored for archives" 1>&2
       fi
 
       if test -n "$vinfo"; then
-	$echo "$modename: warning: \`-version-info/-version-number' is ignored for archives" 1>&2
+	$ECHO "$modename: warning: \`-version-info/-version-number' is ignored for archives" 1>&2
       fi
 
       if test -n "$release"; then
-	$echo "$modename: warning: \`-release' is ignored for archives" 1>&2
+	$ECHO "$modename: warning: \`-release' is ignored for archives" 1>&2
       fi
 
       if test -n "$export_symbols" || test -n "$export_symbols_regex"; then
-	$echo "$modename: warning: \`-export-symbols' is ignored for archives" 1>&2
+	$ECHO "$modename: warning: \`-export-symbols' is ignored for archives" 1>&2
       fi
 
       # Now set the variables for building old libraries.
@@ -2811,46 +2851,46 @@
       # Make sure we only generate libraries of the form `libNAME.la'.
       case $outputname in
       lib*)
-	name=`$echo "X$outputname" | $Xsed -e 's/\.la$//' -e 's/^lib//'`
+	name=`$ECHO "X$outputname" | $Xsed -e 's/\.la$//' -e 's/^lib//'`
 	eval shared_ext=\"$shrext\"
 	eval libname=\"$libname_spec\"
 	;;
       *)
 	if test "$module" = no; then
-	  $echo "$modename: libtool library \`$output' must begin with \`lib'" 1>&2
-	  $echo "$help" 1>&2
+	  $ECHO "$modename: libtool library \`$output' must begin with \`lib'" 1>&2
+	  $ECHO "$help" 1>&2
 	  exit 1
 	fi
 	if test "$need_lib_prefix" != no; then
 	  # Add the "lib" prefix for modules if required
-	  name=`$echo "X$outputname" | $Xsed -e 's/\.la$//'`
+	  name=`$ECHO "X$outputname" | $Xsed -e 's/\.la$//'`
 	  eval shared_ext=\"$shrext\"
 	  eval libname=\"$libname_spec\"
 	else
-	  libname=`$echo "X$outputname" | $Xsed -e 's/\.la$//'`
+	  libname=`$ECHO "X$outputname" | $Xsed -e 's/\.la$//'`
 	fi
 	;;
       esac
 
       if test -n "$objs"; then
 	if test "$deplibs_check_method" != pass_all; then
-	  $echo "$modename: cannot build libtool library \`$output' from non-libtool objects on this host:$objs" 2>&1
+	  $ECHO "$modename: cannot build libtool library \`$output' from non-libtool objects on this host:$objs" 2>&1
 	  exit 1
 	else
-	  $echo
-	  $echo "*** Warning: Linking the shared library $output against the non-libtool"
-	  $echo "*** objects $objs is not portable!"
+	  $ECHO
+	  $ECHO "*** Warning: Linking the shared library $output against the non-libtool"
+	  $ECHO "*** objects $objs is not portable!"
 	  libobjs="$libobjs $objs"
 	fi
       fi
 
       if test "$dlself" != no; then
-	$echo "$modename: warning: \`-dlopen self' is ignored for libtool libraries" 1>&2
+	$ECHO "$modename: warning: \`-dlopen self' is ignored for libtool libraries" 1>&2
       fi
 
       set dummy $rpath
       if test "$#" -gt 2; then
-	$echo "$modename: warning: ignoring multiple \`-rpath's for a libtool library" 1>&2
+	$ECHO "$modename: warning: ignoring multiple \`-rpath's for a libtool library" 1>&2
       fi
       install_libdir="$2"
 
@@ -2867,11 +2907,11 @@
 	fi
 
 	if test -n "$vinfo"; then
-	  $echo "$modename: warning: \`-version-info/-version-number' is ignored for convenience libraries" 1>&2
+	  $ECHO "$modename: warning: \`-version-info/-version-number' is ignored for convenience libraries" 1>&2
 	fi
 
 	if test -n "$release"; then
-	  $echo "$modename: warning: \`-release' is ignored for convenience libraries" 1>&2
+	  $ECHO "$modename: warning: \`-release' is ignored for convenience libraries" 1>&2
 	fi
       else
 
@@ -2881,8 +2921,8 @@
 	IFS="$save_ifs"
 
 	if test -n "$8"; then
-	  $echo "$modename: too many parameters to \`-version-info'" 1>&2
-	  $echo "$help" 1>&2
+	  $ECHO "$modename: too many parameters to \`-version-info'" 1>&2
+	  $ECHO "$help" 1>&2
 	  exit 1
 	fi
 
@@ -2931,8 +2971,8 @@
 	case $current in
 	0 | [1-9] | [1-9][0-9] | [1-9][0-9][0-9]) ;;
 	*)
-	  $echo "$modename: CURRENT \`$current' is not a nonnegative integer" 1>&2
-	  $echo "$modename: \`$vinfo' is not valid version information" 1>&2
+	  $ECHO "$modename: CURRENT \`$current' is not a nonnegative integer" 1>&2
+	  $ECHO "$modename: \`$vinfo' is not valid version information" 1>&2
 	  exit 1
 	  ;;
 	esac
@@ -2940,8 +2980,8 @@
 	case $revision in
 	0 | [1-9] | [1-9][0-9] | [1-9][0-9][0-9]) ;;
 	*)
-	  $echo "$modename: REVISION \`$revision' is not a nonnegative integer" 1>&2
-	  $echo "$modename: \`$vinfo' is not valid version information" 1>&2
+	  $ECHO "$modename: REVISION \`$revision' is not a nonnegative integer" 1>&2
+	  $ECHO "$modename: \`$vinfo' is not valid version information" 1>&2
 	  exit 1
 	  ;;
 	esac
@@ -2949,15 +2989,15 @@
 	case $age in
 	0 | [1-9] | [1-9][0-9] | [1-9][0-9][0-9]) ;;
 	*)
-	  $echo "$modename: AGE \`$age' is not a nonnegative integer" 1>&2
-	  $echo "$modename: \`$vinfo' is not valid version information" 1>&2
+	  $ECHO "$modename: AGE \`$age' is not a nonnegative integer" 1>&2
+	  $ECHO "$modename: \`$vinfo' is not valid version information" 1>&2
 	  exit 1
 	  ;;
 	esac
 
 	if test "$age" -gt "$current"; then
-	  $echo "$modename: AGE \`$age' is greater than the current interface number \`$current'" 1>&2
-	  $echo "$modename: \`$vinfo' is not valid version information" 1>&2
+	  $ECHO "$modename: AGE \`$age' is greater than the current interface number \`$current'" 1>&2
+	  $ECHO "$modename: \`$vinfo' is not valid version information" 1>&2
 	  exit 1
 	fi
 
@@ -3045,8 +3085,8 @@
 	  ;;
 
 	*)
-	  $echo "$modename: unknown library version type \`$version_type'" 1>&2
-	  $echo "Fatal configuration error.  See the $PACKAGE docs for more information." 1>&2
+	  $ECHO "$modename: unknown library version type \`$version_type'" 1>&2
+	  $ECHO "Fatal configuration error.  See the $PACKAGE docs for more information." 1>&2
 	  exit 1
 	  ;;
 	esac
@@ -3081,7 +3121,7 @@
 	# Check to see if the archive will have undefined symbols.
 	if test "$allow_undefined" = yes; then
 	  if test "$allow_undefined_flag" = unsupported; then
-	    $echo "$modename: warning: undefined symbols not allowed in $host shared libraries" 1>&2
+	    $ECHO "$modename: warning: undefined symbols not allowed in $host shared libraries" 1>&2
 	    build_libtool_libs=no
 	    build_old_libs=yes
 	  fi
@@ -3095,7 +3135,7 @@
 	# Remove our outputs, but don't remove object files since they
 	# may have been created when compiling PIC objects.
 	removelist=
-	tempremovelist=`$echo "$output_objdir/*"`
+	tempremovelist=`$ECHO "$output_objdir/*"`
 	for p in $tempremovelist; do
 	  case $p in
 	    *.$objext | *$exeext)
@@ -3117,14 +3157,14 @@
 	oldlibs="$oldlibs $output_objdir/$libname.$libext"
 
 	# Transform .lo files to .o files.
-	oldobjs="$objs "`$echo "X$libobjs" | $SP2NL | $Xsed -e '/\.'${libext}'$/d' -e "$lo2o" | $NL2SP`
+	oldobjs="$objs "`$ECHO "X$libobjs" | $SP2NL | $Xsed -e '/\.'${libext}'$/d' -e "$lo2o" | $NL2SP`
       fi
 
       # Eliminate all temporary directories.
       for path in $notinst_path; do
-	lib_search_path=`$echo "$lib_search_path " | ${SED} -e 's% $path % %g'`
-	deplibs=`$echo "$deplibs " | ${SED} -e 's% -L$path % %g'`
-	dependency_libs=`$echo "$dependency_libs " | ${SED} -e 's% -L$path % %g'`
+	lib_search_path=`$ECHO "$lib_search_path " | ${SED} -e 's% $path % %g'`
+	deplibs=`$ECHO "$deplibs " | ${SED} -e 's% -L$path % %g'`
+	dependency_libs=`$ECHO "$dependency_libs " | ${SED} -e 's% -L$path % %g'`
       done
 
       if test -n "$xrpath"; then
@@ -3237,21 +3277,21 @@
 		  esac
 	        fi
 		if test -n "$i" ; then
-		  libname=`eval \\$echo \"$libname_spec\"`
-		  deplib_matches=`eval \\$echo \"$library_names_spec\"`
+		  libname=`eval \\$ECHO \"$libname_spec\"`
+		  deplib_matches=`eval \\$ECHO \"$library_names_spec\"`
 		  set dummy $deplib_matches
 		  deplib_match=$2
 		  if test `expr "$ldd_output" : ".*$deplib_match"` -ne 0 ; then
 		    newdeplibs="$newdeplibs $i"
 		  else
 		    droppeddeps=yes
-		    $echo
-		    $echo "*** Warning: dynamic linker does not accept needed library $i."
-		    $echo "*** I have the capability to make that library automatically link in when"
-		    $echo "*** you link to this library.  But I can only do this if you have a"
-		    $echo "*** shared version of the library, which I believe you do not have"
-		    $echo "*** because a test_compile did reveal that the linker did not use it for"
-		    $echo "*** its dynamic dependency list that programs get resolved with at runtime."
+		    $ECHO
+		    $ECHO "*** Warning: dynamic linker does not accept needed library $i."
+		    $ECHO "*** I have the capability to make that library automatically link in when"
+		    $ECHO "*** you link to this library.  But I can only do this if you have a"
+		    $ECHO "*** shared version of the library, which I believe you do not have"
+		    $ECHO "*** because a test_compile did reveal that the linker did not use it for"
+		    $ECHO "*** its dynamic dependency list that programs get resolved with at runtime."
 		  fi
 		fi
 	      else
@@ -3279,30 +3319,30 @@
 		    esac
 		  fi
 		  if test -n "$i" ; then
-		    libname=`eval \\$echo \"$libname_spec\"`
-		    deplib_matches=`eval \\$echo \"$library_names_spec\"`
+		    libname=`eval \\$ECHO \"$libname_spec\"`
+		    deplib_matches=`eval \\$ECHO \"$library_names_spec\"`
 		    set dummy $deplib_matches
 		    deplib_match=$2
 		    if test `expr "$ldd_output" : ".*$deplib_match"` -ne 0 ; then
 		      newdeplibs="$newdeplibs $i"
 		    else
 		      droppeddeps=yes
-		      $echo
-		      $echo "*** Warning: dynamic linker does not accept needed library $i."
-		      $echo "*** I have the capability to make that library automatically link in when"
-		      $echo "*** you link to this library.  But I can only do this if you have a"
-		      $echo "*** shared version of the library, which you do not appear to have"
-		      $echo "*** because a test_compile did reveal that the linker did not use this one"
-		      $echo "*** as a dynamic dependency that programs can get resolved with at runtime."
+		      $ECHO
+		      $ECHO "*** Warning: dynamic linker does not accept needed library $i."
+		      $ECHO "*** I have the capability to make that library automatically link in when"
+		      $ECHO "*** you link to this library.  But I can only do this if you have a"
+		      $ECHO "*** shared version of the library, which you do not appear to have"
+		      $ECHO "*** because a test_compile did reveal that the linker did not use this one"
+		      $ECHO "*** as a dynamic dependency that programs can get resolved with at runtime."
 		    fi
 		  fi
 		else
 		  droppeddeps=yes
-		  $echo
-		  $echo "*** Warning!  Library $i is needed by this library but I was not able to"
-		  $echo "***  make it link in!  You will probably need to install it or some"
-		  $echo "*** library that it depends on before this library will be fully"
-		  $echo "*** functional.  Installing it before continuing would be even better."
+		  $ECHO
+		  $ECHO "*** Warning!  Library $i is needed by this library but I was not able to"
+		  $ECHO "***  make it link in!  You will probably need to install it or some"
+		  $ECHO "*** library that it depends on before this library will be fully"
+		  $ECHO "*** functional.  Installing it before continuing would be even better."
 		fi
 	      else
 		newdeplibs="$newdeplibs $i"
@@ -3326,7 +3366,7 @@
 		esac
 	      fi
 	      if test -n "$a_deplib" ; then
-		libname=`eval \\$echo \"$libname_spec\"`
+		libname=`eval \\$ECHO \"$libname_spec\"`
 		for i in $lib_search_path $sys_lib_search_path $shlib_search_path; do
 		  potential_libs=`ls $i/$libname[.-]* 2>/dev/null`
 		  for potent_lib in $potential_libs; do
@@ -3345,7 +3385,7 @@
 			potliblink=`ls -ld $potlib | ${SED} 's/.* -> //'`
 			case $potliblink in
 			[\\/]* | [A-Za-z]:[\\/]*) potlib="$potliblink";;
-			*) potlib=`$echo "X$potlib" | $Xsed -e 's,[^/]*$,,'`"$potliblink";;
+			*) potlib=`$ECHO "X$potlib" | $Xsed -e 's,[^/]*$,,'`"$potliblink";;
 			esac
 		      done
 		      if eval $file_magic_cmd \"\$potlib\" 2>/dev/null \
@@ -3360,17 +3400,17 @@
 	      fi
 	      if test -n "$a_deplib" ; then
 		droppeddeps=yes
-		$echo
-		$echo "*** Warning: linker path does not have real file for library $a_deplib."
-		$echo "*** I have the capability to make that library automatically link in when"
-		$echo "*** you link to this library.  But I can only do this if you have a"
-		$echo "*** shared version of the library, which you do not appear to have"
-		$echo "*** because I did check the linker path looking for a file starting"
+		$ECHO
+		$ECHO "*** Warning: linker path does not have real file for library $a_deplib."
+		$ECHO "*** I have the capability to make that library automatically link in when"
+		$ECHO "*** you link to this library.  But I can only do this if you have a"
+		$ECHO "*** shared version of the library, which you do not appear to have"
+		$ECHO "*** because I did check the linker path looking for a file starting"
 		if test -z "$potlib" ; then
-		  $echo "*** with $libname but no candidates were found. (...for file magic test)"
+		  $ECHO "*** with $libname but no candidates were found. (...for file magic test)"
 		else
-		  $echo "*** with $libname and none of the candidates passed a file format test"
-		  $echo "*** using a file magic. Last file checked: $potlib"
+		  $ECHO "*** with $libname and none of the candidates passed a file format test"
+		  $ECHO "*** using a file magic. Last file checked: $potlib"
 		fi
 	      fi
 	    else
@@ -3395,12 +3435,12 @@
 		esac
 	      fi
 	      if test -n "$a_deplib" ; then
-		libname=`eval \\$echo \"$libname_spec\"`
+		libname=`eval \\$ECHO \"$libname_spec\"`
 		for i in $lib_search_path $sys_lib_search_path $shlib_search_path; do
 		  potential_libs=`ls $i/$libname[.-]* 2>/dev/null`
 		  for potent_lib in $potential_libs; do
 		    potlib="$potent_lib" # see symlink-check above in file_magic test
-		    if eval $echo \"$potent_lib\" 2>/dev/null \
+		    if eval $ECHO \"$potent_lib\" 2>/dev/null \
 		        | ${SED} 10q \
 		        | $EGREP "$match_pattern_regex" > /dev/null; then
 		      newdeplibs="$newdeplibs $a_deplib"
@@ -3412,17 +3452,17 @@
 	      fi
 	      if test -n "$a_deplib" ; then
 		droppeddeps=yes
-		$echo
-		$echo "*** Warning: linker path does not have real file for library $a_deplib."
-		$echo "*** I have the capability to make that library automatically link in when"
-		$echo "*** you link to this library.  But I can only do this if you have a"
-		$echo "*** shared version of the library, which you do not appear to have"
-		$echo "*** because I did check the linker path looking for a file starting"
+		$ECHO
+		$ECHO "*** Warning: linker path does not have real file for library $a_deplib."
+		$ECHO "*** I have the capability to make that library automatically link in when"
+		$ECHO "*** you link to this library.  But I can only do this if you have a"
+		$ECHO "*** shared version of the library, which you do not appear to have"
+		$ECHO "*** because I did check the linker path looking for a file starting"
 		if test -z "$potlib" ; then
-		  $echo "*** with $libname but no candidates were found. (...for regex pattern test)"
+		  $ECHO "*** with $libname but no candidates were found. (...for regex pattern test)"
 		else
-		  $echo "*** with $libname and none of the candidates passed a file format test"
-		  $echo "*** using a regex pattern. Last file checked: $potlib"
+		  $ECHO "*** with $libname and none of the candidates passed a file format test"
+		  $ECHO "*** using a regex pattern. Last file checked: $potlib"
 		fi
 	      fi
 	    else
@@ -3433,23 +3473,23 @@
 	  ;;
 	none | unknown | *)
 	  newdeplibs=""
-	  tmp_deplibs=`$echo "X $deplibs" | $Xsed -e 's/ -lc$//' \
+	  tmp_deplibs=`$ECHO "X $deplibs" | $Xsed -e 's/ -lc$//' \
 	    -e 's/ -[LR][^ ]*//g'`
 	  if test "X$allow_libtool_libs_with_static_runtimes" = "Xyes" ; then
 	    for i in $predeps $postdeps ; do
 	      # can't use Xsed below, because $i might contain '/'
-	      tmp_deplibs=`$echo "X $tmp_deplibs" | ${SED} -e "1s,^X,," -e "s,$i,,"`
+	      tmp_deplibs=`$ECHO "X $tmp_deplibs" | ${SED} -e "1s,^X,," -e "s,$i,,"`
 	    done
 	  fi
-	  if $echo "X $tmp_deplibs" | $Xsed -e 's/[ 	]//g' \
+	  if $ECHO "X $tmp_deplibs" | $Xsed -e 's/[ 	]//g' \
 	    | grep . >/dev/null; then
-	    $echo
+	    $ECHO
 	    if test "X$deplibs_check_method" = "Xnone"; then
-	      $echo "*** Warning: inter-library dependencies are not supported in this platform."
+	      $ECHO "*** Warning: inter-library dependencies are not supported in this platform."
 	    else
-	      $echo "*** Warning: inter-library dependencies are not known to be supported."
+	      $ECHO "*** Warning: inter-library dependencies are not known to be supported."
 	    fi
-	    $echo "*** All declared inter-library dependencies are being dropped."
+	    $ECHO "*** All declared inter-library dependencies are being dropped."
 	    droppeddeps=yes
 	  fi
 	  ;;
@@ -3463,23 +3503,23 @@
 	case $host in
 	*-*-rhapsody* | *-*-darwin1.[012])
 	  # On Rhapsody replace the C library is the System framework
-	  newdeplibs=`$echo "X $newdeplibs" | $Xsed -e 's/ -lc / System.ltframework /'`
+	  newdeplibs=`$ECHO "X $newdeplibs" | $Xsed -e 's/ -lc / System.ltframework /'`
 	  ;;
 	esac
 
 	if test "$droppeddeps" = yes; then
 	  if test "$module" = yes; then
-	    $echo
-	    $echo "*** Warning: libtool could not satisfy all declared inter-library"
-	    $echo "*** dependencies of module $libname.  Therefore, libtool will create"
-	    $echo "*** a static module, that should work as long as the dlopening"
-	    $echo "*** application is linked with the -dlopen flag."
+	    $ECHO
+	    $ECHO "*** Warning: libtool could not satisfy all declared inter-library"
+	    $ECHO "*** dependencies of module $libname.  Therefore, libtool will create"
+	    $ECHO "*** a static module, that should work as long as the dlopening"
+	    $ECHO "*** application is linked with the -dlopen flag."
 	    if test -z "$global_symbol_pipe"; then
-	      $echo
-	      $echo "*** However, this would only work if libtool was able to extract symbol"
-	      $echo "*** lists from a program, using \`nm' or equivalent, but libtool could"
-	      $echo "*** not find such a program.  So, this module is probably useless."
-	      $echo "*** \`nm' from GNU binutils and a full rebuild may help."
+	      $ECHO
+	      $ECHO "*** However, this would only work if libtool was able to extract symbol"
+	      $ECHO "*** lists from a program, using \`nm' or equivalent, but libtool could"
+	      $ECHO "*** not find such a program.  So, this module is probably useless."
+	      $ECHO "*** \`nm' from GNU binutils and a full rebuild may help."
 	    fi
 	    if test "$build_old_libs" = no; then
 	      oldlibs="$output_objdir/$libname.$libext"
@@ -3489,16 +3529,16 @@
 	      build_libtool_libs=no
 	    fi
 	  else
-	    $echo "*** The inter-library dependencies that have been dropped here will be"
-	    $echo "*** automatically added whenever a program is linked with this library"
-	    $echo "*** or is declared to -dlopen it."
+	    $ECHO "*** The inter-library dependencies that have been dropped here will be"
+	    $ECHO "*** automatically added whenever a program is linked with this library"
+	    $ECHO "*** or is declared to -dlopen it."
 
 	    if test "$allow_undefined" = no; then
-	      $echo
-	      $echo "*** Since this library must not contain undefined symbols,"
-	      $echo "*** because either the platform does not support them or"
-	      $echo "*** it was explicitly requested with -no-undefined,"
-	      $echo "*** libtool will only create a static version of it."
+	      $ECHO
+	      $ECHO "*** Since this library must not contain undefined symbols,"
+	      $ECHO "*** because either the platform does not support them or"
+	      $ECHO "*** it was explicitly requested with -no-undefined,"
+	      $ECHO "*** libtool will only create a static version of it."
 	      if test "$build_old_libs" = no; then
 		oldlibs="$output_objdir/$libname.$libext"
 		build_libtool_libs=module
@@ -3512,8 +3552,8 @@
 	# Time to change all our "foo.ltframework" stuff back to "-framework foo"
 	case $host in
 	  *-*-darwin*)
-	    newdeplibs=`$echo "X $newdeplibs" | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
-	    dependency_libs=`$echo "X $dependency_libs" | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
+	    newdeplibs=`$ECHO "X $newdeplibs" | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
+	    dependency_libs=`$ECHO "X $dependency_libs" | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
 	    ;;
 	esac
 	# Done checking deplibs!
@@ -3609,7 +3649,7 @@
 	done
 
 	# Use standard objects if they are pic
-	test -z "$pic_flag" && libobjs=`$echo "X$libobjs" | $SP2NL | $Xsed -e "$lo2o" | $NL2SP`
+	test -z "$pic_flag" && libobjs=`$ECHO "X$libobjs" | $SP2NL | $Xsed -e "$lo2o" | $NL2SP`
 
 	# Prepare the list of exported symbols
 	if test -z "$export_symbols"; then
@@ -3643,7 +3683,7 @@
 	fi
 
 	if test -n "$export_symbols" && test -n "$include_expsyms"; then
-	  $run eval '$echo "X$include_expsyms" | $SP2NL >> "$export_symbols"'
+	  $run eval '$ECHO "X$include_expsyms" | $SP2NL >> "$export_symbols"'
 	fi
 
 	tmp_deplibs=
@@ -3679,7 +3719,7 @@
 	      [\\/]* | [A-Za-z]:[\\/]*) xabs="$xlib" ;;
 	      *) xabs=`pwd`"/$xlib" ;;
 	      esac
-	      xlib=`$echo "X$xlib" | $Xsed -e 's%^.*/%%'`
+	      xlib=`$ECHO "X$xlib" | $Xsed -e 's%^.*/%%'`
 	      xdir="$gentop/$xlib"
 
 	      $show "${rm}r $xdir"
@@ -3698,8 +3738,8 @@
 	      if ($AR t "$xabs" | sort | sort -uc >/dev/null 2>&1); then
 		:
 	      else
-		$echo "$modename: warning: object name conflicts; renaming object files" 1>&2
-		$echo "$modename: warning: to ensure that they will not overwrite" 1>&2
+		$ECHO "$modename: warning: object name conflicts; renaming object files" 1>&2
+		$ECHO "$modename: warning: to ensure that they will not overwrite" 1>&2
 		$AR t "$xabs" | sort | uniq -cd | while read -r count name
 		do
 		  i=1
@@ -3710,7 +3750,7 @@
 		   name_to="$name"
 		   while test "X$name_to" = "X$name" || test -f "$xdir/$name_to"
 		   do
-		     name_to=`$echo "X$name_to" | $Xsed -e "s/\([^.]*\)/\1-$i/"`
+		     name_to=`$ECHO "X$name_to" | $Xsed -e "s/\([^.]*\)/\1-$i/"`
 		   done
 		   $show "(cd $xdir && $AR xN $i $xabs '$name' && $mv '$name' '$name_to')"
 		   $run eval "(cd \$xdir && $AR xN $i \$xabs '$name' && $mv '$name' '$name_to')" || exit $?
@@ -3763,7 +3803,7 @@
 	  :
 	else
 	  # The command line is too long to link in one step, link piecewise.
-	  $echo "creating reloadable object files..."
+	  $ECHO "creating reloadable object files..."
 
 	  # Save the value of $output and $libobjs because we want to
 	  # use them later.  If we have whole_archive_flag_spec, we
@@ -3837,7 +3877,7 @@
 	    delfiles="$delfiles $output_objdir/$save_output-${i}.$objext"
 	  done
 
-	  $echo "creating a temporary reloadable object file: $output"
+	  $ECHO "creating a temporary reloadable object file: $output"
 
 	  # Loop through the commands generated above and execute them.
 	  save_ifs="$IFS"; IFS='~'
@@ -3901,37 +3941,37 @@
 
     obj)
       if test -n "$deplibs"; then
-	$echo "$modename: warning: \`-l' and \`-L' are ignored for objects" 1>&2
+	$ECHO "$modename: warning: \`-l' and \`-L' are ignored for objects" 1>&2
       fi
 
       if test -n "$dlfiles$dlprefiles" || test "$dlself" != no; then
-	$echo "$modename: warning: \`-dlopen' is ignored for objects" 1>&2
+	$ECHO "$modename: warning: \`-dlopen' is ignored for objects" 1>&2
       fi
 
       if test -n "$rpath"; then
-	$echo "$modename: warning: \`-rpath' is ignored for objects" 1>&2
+	$ECHO "$modename: warning: \`-rpath' is ignored for objects" 1>&2
       fi
 
       if test -n "$xrpath"; then
-	$echo "$modename: warning: \`-R' is ignored for objects" 1>&2
+	$ECHO "$modename: warning: \`-R' is ignored for objects" 1>&2
       fi
 
       if test -n "$vinfo"; then
-	$echo "$modename: warning: \`-version-info' is ignored for objects" 1>&2
+	$ECHO "$modename: warning: \`-version-info' is ignored for objects" 1>&2
       fi
 
       if test -n "$release"; then
-	$echo "$modename: warning: \`-release' is ignored for objects" 1>&2
+	$ECHO "$modename: warning: \`-release' is ignored for objects" 1>&2
       fi
 
       case $output in
       *.lo)
 	if test -n "$objs$old_deplibs"; then
-	  $echo "$modename: cannot build library object \`$output' from non-libtool objects" 1>&2
+	  $ECHO "$modename: cannot build library object \`$output' from non-libtool objects" 1>&2
 	  exit 1
 	fi
 	libobj="$output"
-	obj=`$echo "X$output" | $Xsed -e "$lo2o"`
+	obj=`$ECHO "X$output" | $Xsed -e "$lo2o"`
 	;;
       *)
 	libobj=
@@ -3973,7 +4013,7 @@
 	    [\\/]* | [A-Za-z]:[\\/]*) xabs="$xlib" ;;
 	    *) xabs=`pwd`"/$xlib" ;;
 	    esac
-	    xlib=`$echo "X$xlib" | $Xsed -e 's%^.*/%%'`
+	    xlib=`$ECHO "X$xlib" | $Xsed -e 's%^.*/%%'`
 	    xdir="$gentop/$xlib"
 
 	    $show "${rm}r $xdir"
@@ -3992,8 +4032,8 @@
 	    if ($AR t "$xabs" | sort | sort -uc >/dev/null 2>&1); then
 	      :
 	    else
-	      $echo "$modename: warning: object name conflicts; renaming object files" 1>&2
-	      $echo "$modename: warning: to ensure that they will not overwrite" 1>&2
+	      $ECHO "$modename: warning: object name conflicts; renaming object files" 1>&2
+	      $ECHO "$modename: warning: to ensure that they will not overwrite" 1>&2
 	      $AR t "$xabs" | sort | uniq -cd | while read -r count name
 	      do
 		i=1
@@ -4004,7 +4044,7 @@
 		 name_to="$name"
 		 while test "X$name_to" = "X$name" || test -f "$xdir/$name_to"
 		 do
-		   name_to=`$echo "X$name_to" | $Xsed -e "s/\([^.]*\)/\1-$i/"`
+		   name_to=`$ECHO "X$name_to" | $Xsed -e "s/\([^.]*\)/\1-$i/"`
 		 done
 		 $show "(cd $xdir && $AR xN $i $xabs '$name' && $mv '$name' '$name_to')"
 		 $run eval "(cd \$xdir && $AR xN $i \$xabs '$name' && $mv '$name' '$name_to')" || exit $?
@@ -4019,7 +4059,7 @@
       fi
 
       # Create the old-style object.
-      reload_objs="$objs$old_deplibs "`$echo "X$libobjs" | $SP2NL | $Xsed -e '/\.'${libext}$'/d' -e '/\.lib$/d' -e "$lo2o" | $NL2SP`" $reload_conv_objs" ### testsuite: skip nested quoting test
+      reload_objs="$objs$old_deplibs "`$ECHO "X$libobjs" | $SP2NL | $Xsed -e '/\.'${libext}$'/d' -e '/\.lib$/d' -e "$lo2o" | $NL2SP`" $reload_conv_objs" ### testsuite: skip nested quoting test
 
       output="$obj"
       eval cmds=\"$reload_cmds\"
@@ -4078,28 +4118,28 @@
 
     prog)
       case $host in
-	*cygwin*) output=`$echo $output | ${SED} -e 's,.exe$,,;s,$,.exe,'` ;;
+	*cygwin*) output=`$ECHO $output | ${SED} -e 's,.exe$,,;s,$,.exe,'` ;;
       esac
       if test -n "$vinfo"; then
-	$echo "$modename: warning: \`-version-info' is ignored for programs" 1>&2
+	$ECHO "$modename: warning: \`-version-info' is ignored for programs" 1>&2
       fi
 
       if test -n "$release"; then
-	$echo "$modename: warning: \`-release' is ignored for programs" 1>&2
+	$ECHO "$modename: warning: \`-release' is ignored for programs" 1>&2
       fi
 
       if test "$preload" = yes; then
 	if test "$dlopen_support" = unknown && test "$dlopen_self" = unknown &&
 	   test "$dlopen_self_static" = unknown; then
-	  $echo "$modename: warning: \`AC_LIBTOOL_DLOPEN' not used. Assuming no dlopen support."
+	  $ECHO "$modename: warning: \`AC_LIBTOOL_DLOPEN' not used. Assuming no dlopen support."
 	fi
       fi
 
       case $host in
       *-*-rhapsody* | *-*-darwin1.[012])
 	# On Rhapsody replace the C library is the System framework
-	compile_deplibs=`$echo "X $compile_deplibs" | $Xsed -e 's/ -lc / System.ltframework /'`
-	finalize_deplibs=`$echo "X $finalize_deplibs" | $Xsed -e 's/ -lc / System.ltframework /'`
+	compile_deplibs=`$ECHO "X $compile_deplibs" | $Xsed -e 's/ -lc / System.ltframework /'`
+	finalize_deplibs=`$ECHO "X $finalize_deplibs" | $Xsed -e 's/ -lc / System.ltframework /'`
 	;;
       esac
 
@@ -4111,8 +4151,8 @@
         finalize_command="$finalize_command ${wl}-bind_at_load"
         fi
 	# Time to change all our "foo.ltframework" stuff back to "-framework foo"
-	compile_deplibs=`$echo "X $compile_deplibs" | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
-	finalize_deplibs=`$echo "X $finalize_deplibs" | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
+	compile_deplibs=`$ECHO "X $compile_deplibs" | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
+	finalize_deplibs=`$ECHO "X $finalize_deplibs" | $Xsed -e 's% \([^ $]*\).ltframework% -framework \1%g'`
         ;;
       esac
 
@@ -4213,8 +4253,8 @@
 
       if test -n "$libobjs" && test "$build_old_libs" = yes; then
 	# Transform all the library objects into standard objects.
-	compile_command=`$echo "X$compile_command" | $SP2NL | $Xsed -e "$lo2o" | $NL2SP`
-	finalize_command=`$echo "X$finalize_command" | $SP2NL | $Xsed -e "$lo2o" | $NL2SP`
+	compile_command=`$ECHO "X$compile_command" | $SP2NL | $Xsed -e "$lo2o" | $NL2SP`
+	finalize_command=`$ECHO "X$finalize_command" | $SP2NL | $Xsed -e "$lo2o" | $NL2SP`
       fi
 
       dlsyms=
@@ -4222,7 +4262,7 @@
 	if test -n "$NM" && test -n "$global_symbol_pipe"; then
 	  dlsyms="${outputname}S.c"
 	else
-	  $echo "$modename: not configured to extract global symbols from dlpreopened files" 1>&2
+	  $ECHO "$modename: not configured to extract global symbols from dlpreopened files" 1>&2
 	fi
       fi
 
@@ -4239,7 +4279,7 @@
 	  # Parse the name list into a source file.
 	  $show "creating $output_objdir/$dlsyms"
 
-	  test -z "$run" && $echo > "$output_objdir/$dlsyms" "\
+	  test -z "$run" && $ECHO > "$output_objdir/$dlsyms" "\
 /* $dlsyms - symbol resolution table for \`$outputname' dlsym emulation. */
 /* Generated by $PROGRAM - GNU $PACKAGE $VERSION$TIMESTAMP */
 
@@ -4256,10 +4296,10 @@
 	  if test "$dlself" = yes; then
 	    $show "generating symbol list for \`$output'"
 
-	    test -z "$run" && $echo ': @PROGRAM@ ' > "$nlist"
+	    test -z "$run" && $ECHO ': @PROGRAM@ ' > "$nlist"
 
 	    # Add our own program objects to the symbol list.
-	    progfiles=`$echo "X$objs$old_deplibs" | $SP2NL | $Xsed -e "$lo2o" | $NL2SP`
+	    progfiles=`$ECHO "X$objs$old_deplibs" | $SP2NL | $Xsed -e "$lo2o" | $NL2SP`
 	    for arg in $progfiles; do
 	      $show "extracting global C symbols from \`$arg'"
 	      $run eval "$NM $arg | $global_symbol_pipe >> '$nlist'"
@@ -4289,8 +4329,8 @@
 
 	  for arg in $dlprefiles; do
 	    $show "extracting global C symbols from \`$arg'"
-	    name=`$echo "$arg" | ${SED} -e 's%^.*/%%'`
-	    $run eval '$echo ": $name " >> "$nlist"'
+	    name=`$ECHO "$arg" | ${SED} -e 's%^.*/%%'`
+	    $run eval '$ECHO ": $name " >> "$nlist"'
 	    $run eval "$NM $arg | $global_symbol_pipe >> '$nlist'"
 	  done
 
@@ -4319,10 +4359,10 @@
 	    if test -f "$nlist"S; then
 	      eval "$global_symbol_to_cdecl"' < "$nlist"S >> "$output_objdir/$dlsyms"'
 	    else
-	      $echo '/* NONE */' >> "$output_objdir/$dlsyms"
+	      $ECHO '/* NONE */' >> "$output_objdir/$dlsyms"
 	    fi
 
-	    $echo >> "$output_objdir/$dlsyms" "\
+	    $ECHO >> "$output_objdir/$dlsyms" "\
 
 #undef lt_preloaded_symbols
 
@@ -4344,7 +4384,7 @@
 
 	    eval "$global_symbol_to_c_name_address" < "$nlist" >> "$output_objdir/$dlsyms"
 
-	    $echo >> "$output_objdir/$dlsyms" "\
+	    $ECHO >> "$output_objdir/$dlsyms" "\
   {0, (lt_ptr) 0}
 };
 
@@ -4389,11 +4429,11 @@
 	  $run $rm "$output_objdir/$dlsyms" "$nlist" "${nlist}S" "${nlist}T"
 
 	  # Transform the symbol file into the correct name.
-	  compile_command=`$echo "X$compile_command" | $Xsed -e "s%@SYMFILE@%$output_objdir/${outputname}S.${objext}%"`
-	  finalize_command=`$echo "X$finalize_command" | $Xsed -e "s%@SYMFILE@%$output_objdir/${outputname}S.${objext}%"`
+	  compile_command=`$ECHO "X$compile_command" | $Xsed -e "s%@SYMFILE@%$output_objdir/${outputname}S.${objext}%"`
+	  finalize_command=`$ECHO "X$finalize_command" | $Xsed -e "s%@SYMFILE@%$output_objdir/${outputname}S.${objext}%"`
 	  ;;
 	*)
-	  $echo "$modename: unknown suffix for \`$dlsyms'" 1>&2
+	  $ECHO "$modename: unknown suffix for \`$dlsyms'" 1>&2
 	  exit 1
 	  ;;
 	esac
@@ -4403,8 +4443,8 @@
 	# really was required.
 
 	# Nullify the symbol file.
-	compile_command=`$echo "X$compile_command" | $Xsed -e "s% @SYMFILE@%%"`
-	finalize_command=`$echo "X$finalize_command" | $Xsed -e "s% @SYMFILE@%%"`
+	compile_command=`$ECHO "X$compile_command" | $Xsed -e "s% @SYMFILE@%%"`
+	finalize_command=`$ECHO "X$finalize_command" | $Xsed -e "s% @SYMFILE@%%"`
       fi
 
       # AIX runtime linking requires linking programs with -Wl,-brtl and libs with -Wl,-G
@@ -4414,13 +4454,13 @@
       case "$host" in
         ia64-*-aix5*) ;;
         *-*-aix4* | *-*-aix5*)
-                   compile_command=`$echo "X$compile_command $wl-brtl" | $Xsed -e "s/\$CC/\$CC $wl-bnolibpath/1"`
-                   finalize_command=`$echo "X$finalize_command $wl-brtl" | $Xsed -e "s/\$CC/\$CC $wl-bnolibpath/1"` ;;
+                   compile_command=`$ECHO "X$compile_command $wl-brtl" | $Xsed -e "s/\$CC/\$CC $wl-bnolibpath/1"`
+                   finalize_command=`$ECHO "X$finalize_command $wl-brtl" | $Xsed -e "s/\$CC/\$CC $wl-bnolibpath/1"` ;;
       esac
 
       if test "$need_relink" = no || test "$build_libtool_libs" != yes; then
 	# Replace the output file specification.
-	compile_command=`$echo "X$compile_command" | $Xsed -e 's%@OUTPUT@%'"$output"'%g'`
+	compile_command=`$ECHO "X$compile_command" | $Xsed -e 's%@OUTPUT@%'"$output"'%g'`
 	link_command="$compile_command$compile_rpath"
 
 	# We have no uninstalled library dependencies, so finalize right now.
@@ -4487,7 +4527,7 @@
 	# We don't need to create a wrapper script.
 	link_command="$compile_var$compile_command$compile_rpath"
 	# Replace the output file specification.
-	link_command=`$echo "X$link_command" | $Xsed -e 's%@OUTPUT@%'"$output"'%g'`
+	link_command=`$ECHO "X$link_command" | $Xsed -e 's%@OUTPUT@%'"$output"'%g'`
 	# Delete the old output file.
 	$run $rm $output
 	# Link the executable and exit
@@ -4501,13 +4541,13 @@
 	link_command="$compile_var$compile_command$compile_rpath"
 	relink_command="$finalize_var$finalize_command$finalize_rpath"
 
-	$echo "$modename: warning: this platform does not like uninstalled shared libraries" 1>&2
-	$echo "$modename: \`$output' will be relinked during installation" 1>&2
+	$ECHO "$modename: warning: this platform does not like uninstalled shared libraries" 1>&2
+	$ECHO "$modename: \`$output' will be relinked during installation" 1>&2
       else
 	if test "$fast_install" != no; then
 	  link_command="$finalize_var$compile_command$finalize_rpath"
 	  if test "$fast_install" = yes; then
-	    relink_command=`$echo "X$compile_var$compile_command$compile_rpath" | $Xsed -e 's%@OUTPUT@%\$progdir/\$file%g'`
+	    relink_command=`$ECHO "X$compile_var$compile_command$compile_rpath" | $Xsed -e 's%@OUTPUT@%\$progdir/\$file%g'`
 	  else
 	    # fast_install is set to needless
 	    relink_command=
@@ -4519,7 +4559,7 @@
       fi
 
       # Replace the output file specification.
-      link_command=`$echo "X$link_command" | $Xsed -e 's%@OUTPUT@%'"$output_objdir/$outputname"'%g'`
+      link_command=`$ECHO "X$link_command" | $Xsed -e 's%@OUTPUT@%'"$output_objdir/$outputname"'%g'`
 
       # Delete the old output files.
       $run $rm $output $output_objdir/$outputname $output_objdir/lt-$outputname
@@ -4539,23 +4579,23 @@
 	  elif eval var_value=\$$var; test -z "$var_value"; then
 	    relink_command="$var=; export $var; $relink_command"
 	  else
-	    var_value=`$echo "X$var_value" | $Xsed -e "$sed_quote_subst"`
+	    var_value=`$ECHO "X$var_value" | $Xsed -e "$sed_quote_subst"`
 	    relink_command="$var=\"$var_value\"; export $var; $relink_command"
 	  fi
 	done
 	relink_command="(cd `pwd`; $relink_command)"
-	relink_command=`$echo "X$relink_command" | $Xsed -e "$sed_quote_subst"`
+	relink_command=`$ECHO "X$relink_command" | $Xsed -e "$sed_quote_subst"`
       fi
 
-      # Quote $echo for shipping.
-      if test "X$echo" = "X$SHELL $0 --fallback-echo"; then
+      # Quote $ECHO for shipping.
+      if test "X$ECHO" = "X$SHELL $0 --fallback-echo"; then
 	case $0 in
 	[\\/]* | [A-Za-z]:[\\/]*) qecho="$SHELL $0 --fallback-echo";;
 	*) qecho="$SHELL `pwd`/$0 --fallback-echo";;
 	esac
-	qecho=`$echo "X$qecho" | $Xsed -e "$sed_quote_subst"`
+	qecho=`$ECHO "X$qecho" | $Xsed -e "$sed_quote_subst"`
       else
-	qecho=`$echo "X$echo" | $Xsed -e "$sed_quote_subst"`
+	qecho=`$ECHO "X$ECHO" | $Xsed -e "$sed_quote_subst"`
       fi
 
       # Only actually do things if our run command is non-null.
@@ -4563,19 +4603,19 @@
 	# win32 will think the script is a binary if it has
 	# a .exe suffix, so we strip it off here.
 	case $output in
-	  *.exe) output=`$echo $output|${SED} 's,.exe$,,'` ;;
+	  *.exe) output=`$ECHO $output|${SED} 's,.exe$,,'` ;;
 	esac
 	# test for cygwin because mv fails w/o .exe extensions
 	case $host in
 	  *cygwin*)
 	    exeext=.exe
-	    outputname=`$echo $outputname|${SED} 's,.exe$,,'` ;;
+	    outputname=`$ECHO $outputname|${SED} 's,.exe$,,'` ;;
 	  *) exeext= ;;
 	esac
 	case $host in
 	  *mingw* )
-	    cwrappersource=`$echo ${output_objdir}/lt-${outputname}.c`
-	    cwrapper=`$echo ${output}.exe`
+	    cwrappersource=`$ECHO ${output_objdir}/lt-${outputname}.c`
+	    cwrapper=`$ECHO ${output}.exe`
 	    $rm $cwrappersource $cwrapper
 	    trap "$rm $cwrappersource $cwrapper; exit 1" 1 2 15
 
@@ -4788,7 +4828,7 @@
 	$rm $output
 	trap "$rm $output; exit 1" 1 2 15
 
-	$echo > $output "\
+	$ECHO > $output "\
 #! $SHELL
 
 # $output - temporary wrapper script for $objdir/$outputname
@@ -4816,7 +4856,7 @@
   # install mode needs the following variable:
   notinst_deplibs='$notinst_deplibs'
 else
-  # When we are sourced in execute mode, \$file and \$echo are already set.
+  # When we are sourced in execute mode, \$file and \$ECHO are already set.
   if test \"\$libtool_execute_magic\" != \"$magic\"; then
     echo=\"$qecho\"
     file=\"\$0\"
@@ -4824,25 +4864,25 @@
     if test \"X\$1\" = X--no-reexec; then
       # Discard the --no-reexec flag, and continue.
       shift
-    elif test \"X\`(\$echo '\t') 2>/dev/null\`\" = 'X\t'; then
-      # Yippee, \$echo works!
+    elif test \"X\`(\$ECHO '\t') 2>/dev/null\`\" = 'X\t'; then
+      # Yippee, \$ECHO works!
       :
     else
-      # Restart under the correct shell, and then maybe \$echo will work.
+      # Restart under the correct shell, and then maybe \$ECHO will work.
       exec $SHELL \"\$0\" --no-reexec \${1+\"\$@\"}
     fi
   fi\
 "
-	$echo >> $output "\
+	$ECHO >> $output "\
 
   # Find the directory that this script lives in.
-  thisdir=\`\$echo \"X\$file\" | \$Xsed -e 's%/[^/]*$%%'\`
+  thisdir=\`\$ECHO \"X\$file\" | \$Xsed -e 's%/[^/]*$%%'\`
   test \"x\$thisdir\" = \"x\$file\" && thisdir=.
 
   # Follow symbolic links until we get to the real thisdir.
   file=\`ls -ld \"\$file\" | ${SED} -n 's/.*-> //p'\`
   while test -n \"\$file\"; do
-    destdir=\`\$echo \"X\$file\" | \$Xsed -e 's%/[^/]*\$%%'\`
+    destdir=\`\$ECHO \"X\$file\" | \$Xsed -e 's%/[^/]*\$%%'\`
 
     # If there was a directory component, then change thisdir.
     if test \"x\$destdir\" != \"x\$file\"; then
@@ -4852,7 +4892,7 @@
       esac
     fi
 
-    file=\`\$echo \"X\$file\" | \$Xsed -e 's%^.*/%%'\`
+    file=\`\$ECHO \"X\$file\" | \$Xsed -e 's%^.*/%%'\`
     file=\`ls -ld \"\$thisdir/\$file\" | ${SED} -n 's/.*-> //p'\`
   done
 
@@ -4862,7 +4902,7 @@
 "
 
 	if test "$fast_install" = yes; then
-	  $echo >> $output "\
+	  $ECHO >> $output "\
   program=lt-'$outputname'$exeext
   progdir=\"\$thisdir/$objdir\"
 
@@ -4878,13 +4918,13 @@
       $rm \"\$progdir/\$file\"
     fi"
 
-	  $echo >> $output "\
+	  $ECHO >> $output "\
 
     # relink executable if necessary
     if test -n \"\$relink_command\"; then
       if relink_command_output=\`eval \$relink_command 2>&1\`; then :
       else
-	$echo \"\$relink_command_output\" >&2
+	$ECHO \"\$relink_command_output\" >&2
 	$rm \"\$progdir/\$file\"
 	exit 1
       fi
@@ -4896,25 +4936,25 @@
     $rm \"\$progdir/\$file\"
   fi"
 	else
-	  $echo >> $output "\
+	  $ECHO >> $output "\
   program='$outputname'
   progdir=\"\$thisdir/$objdir\"
 "
 	fi
 
-	$echo >> $output "\
+	$ECHO >> $output "\
 
   if test -f \"\$progdir/\$program\"; then"
 
 	# Export our shlibpath_var if we have one.
 	if test "$shlibpath_overrides_runpath" = yes && test -n "$shlibpath_var" && test -n "$temp_rpath"; then
-	  $echo >> $output "\
+	  $ECHO >> $output "\
     # Add our own library path to $shlibpath_var
     $shlibpath_var=\"$temp_rpath\$$shlibpath_var\"
 
     # Some systems cannot cope with colon-terminated $shlibpath_var
     # The second colon is a workaround for a bug in BeOS R4 sed
-    $shlibpath_var=\`\$echo \"X\$$shlibpath_var\" | \$Xsed -e 's/::*\$//'\`
+    $shlibpath_var=\`\$ECHO \"X\$$shlibpath_var\" | \$Xsed -e 's/::*\$//'\`
 
     export $shlibpath_var
 "
@@ -4922,20 +4962,20 @@
 
 	# fixup the dll searchpath if we need to.
 	if test -n "$dllsearchpath"; then
-	  $echo >> $output "\
+	  $ECHO >> $output "\
     # Add the dll search path components to the executable PATH
     PATH=$dllsearchpath:\$PATH
 "
 	fi
 
-	$echo >> $output "\
+	$ECHO >> $output "\
     if test \"\$libtool_execute_magic\" != \"$magic\"; then
       # Run the actual program with our arguments.
 "
 	case $host in
 	# Backslashes separate directories on plain windows
 	*-*-mingw | *-*-os2*)
-	  $echo >> $output "\
+	  $ECHO >> $output "\
       exec \$progdir\\\\\$program \${1+\"\$@\"}
 "
 	  ;;
@@ -4943,20 +4983,20 @@
 	*)
 	  # Need to set LD_LIBRARY_PATH, to the value already
 	  # computed within libtool.
-	  $echo >> $output "\
+	  $ECHO >> $output "\
       LD_LIBRARY_PATH=\"$rpath\" exec \$progdir/\$program \${1+\"\$@\"}
 "
 	  ;;
 	esac
-	$echo >> $output "\
-      \$echo \"\$0: cannot exec \$program \${1+\"\$@\"}\"
+	$ECHO >> $output "\
+      \$ECHO \"\$0: cannot exec \$program \${1+\"\$@\"}\"
       exit 1
     fi
   else
     # The program doesn't exist.
-    \$echo \"\$0: error: \$progdir/\$program does not exist\" 1>&2
-    \$echo \"This script is just a wrapper for \$program.\" 1>&2
-    $echo \"See the $PACKAGE documentation for more information.\" 1>&2
+    \$ECHO \"\$0: error: \$progdir/\$program does not exist\" 1>&2
+    \$ECHO \"This script is just a wrapper for \$program.\" 1>&2
+    $ECHO \"See the $PACKAGE documentation for more information.\" 1>&2
     exit 1
   fi
 fi\
@@ -5003,7 +5043,7 @@
 	  [\\/]* | [A-Za-z]:[\\/]*) xabs="$xlib" ;;
 	  *) xabs=`pwd`"/$xlib" ;;
 	  esac
-	  xlib=`$echo "X$xlib" | $Xsed -e 's%^.*/%%'`
+	  xlib=`$ECHO "X$xlib" | $Xsed -e 's%^.*/%%'`
 	  xdir="$gentop/$xlib"
 
 	  $show "${rm}r $xdir"
@@ -5022,8 +5062,8 @@
 	  if ($AR t "$xabs" | sort | sort -uc >/dev/null 2>&1); then
 	    :
 	  else
-	    $echo "$modename: warning: object name conflicts; renaming object files" 1>&2
-	    $echo "$modename: warning: to ensure that they will not overwrite" 1>&2
+	    $ECHO "$modename: warning: object name conflicts; renaming object files" 1>&2
+	    $ECHO "$modename: warning: to ensure that they will not overwrite" 1>&2
 	    $AR t "$xabs" | sort | uniq -cd | while read -r count name
 	    do
 	      i=1
@@ -5034,7 +5074,7 @@
 	       name_to="$name"
 	       while test "X$name_to" = "X$name" || test -f "$xdir/$name_to"
 	       do
-		 name_to=`$echo "X$name_to" | $Xsed -e "s/\([^.]*\)/\1-$i/"`
+		 name_to=`$ECHO "X$name_to" | $Xsed -e "s/\([^.]*\)/\1-$i/"`
 	       done
 	       $show "(cd $xdir && $AR xN $i $xabs '$name' && $mv '$name' '$name_to')"
 	       $run eval "(cd \$xdir && $AR xN $i \$xabs '$name' && $mv '$name' '$name_to')" || exit $?
@@ -5060,7 +5100,7 @@
 	  :
 	else
 	  # the command line is too long to link in one step, link in parts
-	  $echo "using piecewise archive linking..."
+	  $ECHO "using piecewise archive linking..."
 	  save_RANLIB=$RANLIB
 	  RANLIB=:
 	  objlist=
@@ -5072,12 +5112,12 @@
 	  # names appear in distinct ar calls; check, warn and compensate.
 	    if (for obj in $save_oldobjs
 	    do
-	      $echo "X$obj" | $Xsed -e 's%^.*/%%'
+	      $ECHO "X$obj" | $Xsed -e 's%^.*/%%'
 	    done | sort | sort -uc >/dev/null 2>&1); then
 	    :
 	  else
-	    $echo "$modename: warning: object name conflicts; overriding AR_FLAGS to 'cq'" 1>&2
-	    $echo "$modename: warning: to ensure that POSIX-compatible ar will work" 1>&2
+	    $ECHO "$modename: warning: object name conflicts; overriding AR_FLAGS to 'cq'" 1>&2
+	    $ECHO "$modename: warning: to ensure that POSIX-compatible ar will work" 1>&2
 	    AR_FLAGS=cq
 	  fi
 	  # Is there a better way of finding the last object in the list?
@@ -5141,13 +5181,13 @@
 	elif eval var_value=\$$var; test -z "$var_value"; then
 	  relink_command="$var=; export $var; $relink_command"
 	else
-	  var_value=`$echo "X$var_value" | $Xsed -e "$sed_quote_subst"`
+	  var_value=`$ECHO "X$var_value" | $Xsed -e "$sed_quote_subst"`
 	  relink_command="$var=\"$var_value\"; export $var; $relink_command"
 	fi
       done
       # Quote the link command for shipping.
       relink_command="(cd `pwd`; $SHELL $0 --mode=relink $libtool_args @inst_prefix_dir@)"
-      relink_command=`$echo "X$relink_command" | $Xsed -e "$sed_quote_subst"`
+      relink_command=`$ECHO "X$relink_command" | $Xsed -e "$sed_quote_subst"`
       if test "$hardcode_automatic" = yes ; then
         relink_command=
       fi  
@@ -5164,24 +5204,68 @@
 	    for deplib in $dependency_libs; do
 	      case $deplib in
 	      *.la)
-		name=`$echo "X$deplib" | $Xsed -e 's%^.*/%%'`
+		name=`$ECHO "X$deplib" | $Xsed -e 's%^.*/%%'`
 		eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $deplib`
 		if test -z "$libdir"; then
-		  $echo "$modename: \`$deplib' is not a valid libtool archive" 1>&2
+		  $ECHO "$modename: \`$deplib' is not a valid libtool archive" 1>&2
 		  exit 1
 		fi
-		newdependency_libs="$newdependency_libs $libdir/$name"
+		if test "x$EGREP" = x ; then
+			EGREP=egrep
+		fi
+		# We do not want portage's install root ($D) present.  Check only for
+		# this if the .la is being installed.
+		if test "$installed" = yes && test "$D"; then
+		  eval mynewdependency_lib=`echo "$libdir/$name" |sed -e "s:$D:/:g" -e 's:/\+:/:g'`
+		else
+		  mynewdependency_lib="$libdir/$name"
+		fi
+		# Do not add duplicates
+		if test "$mynewdependency_lib"; then
+		  my_little_ninja_foo_1=`echo $newdependency_libs |$EGREP -e "$mynewdependency_lib"`
+		  if test -z "$my_little_ninja_foo_1"; then
+		    newdependency_libs="$newdependency_libs $mynewdependency_lib"
+		  fi
+		fi
+		;;
+		  *)
+		if test "$installed" = yes; then
+		  # Rather use S=WORKDIR if our version of portage supports it.
+		  # This is because some ebuild (gcc) do not use $S as buildroot.
+		  if test "$PWORKDIR"; then
+		    S="$PWORKDIR"
+		  fi
+		  # We do not want portage's build root ($S) present.
+		  my_little_ninja_foo_2=`echo $deplib |$EGREP -e "$S"`
+		  # We do not want portage's install root ($D) present.
+		  my_little_ninja_foo_3=`echo $deplib |$EGREP -e "$D"`
+		  if test -n "$my_little_ninja_foo_2" && test "$S"; then
+		    mynewdependency_lib=""
+		  elif test -n "$my_little_ninja_foo_3" && test "$D"; then
+		    eval mynewdependency_lib=`echo "$deplib" |sed -e "s:$D:/:g" -e 's:/\+:/:g'`
+		  else
+		    mynewdependency_lib="$deplib"
+		  fi
+		else
+		  mynewdependency_lib="$deplib"
+		fi
+		# Do not add duplicates
+		if test "$mynewdependency_lib"; then
+		  my_little_ninja_foo_4=`echo $newdependency_libs |$EGREP -e "$mynewdependency_lib"`
+		  if test -z "$my_little_ninja_foo_4"; then
+			newdependency_libs="$newdependency_libs $mynewdependency_lib"
+		  fi
+		fi
 		;;
-	      *) newdependency_libs="$newdependency_libs $deplib" ;;
 	      esac
 	    done
 	    dependency_libs="$newdependency_libs"
 	    newdlfiles=
 	    for lib in $dlfiles; do
-	      name=`$echo "X$lib" | $Xsed -e 's%^.*/%%'`
+	      name=`$ECHO "X$lib" | $Xsed -e 's%^.*/%%'`
 	      eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $lib`
 	      if test -z "$libdir"; then
-		$echo "$modename: \`$lib' is not a valid libtool archive" 1>&2
+		$ECHO "$modename: \`$lib' is not a valid libtool archive" 1>&2
 		exit 1
 	      fi
 	      newdlfiles="$newdlfiles $libdir/$name"
@@ -5189,10 +5273,10 @@
 	    dlfiles="$newdlfiles"
 	    newdlprefiles=
 	    for lib in $dlprefiles; do
-	      name=`$echo "X$lib" | $Xsed -e 's%^.*/%%'`
+	      name=`$ECHO "X$lib" | $Xsed -e 's%^.*/%%'`
 	      eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $lib`
 	      if test -z "$libdir"; then
-		$echo "$modename: \`$lib' is not a valid libtool archive" 1>&2
+		$ECHO "$modename: \`$lib' is not a valid libtool archive" 1>&2
 		exit 1
 	      fi
 	      newdlprefiles="$newdlprefiles $libdir/$name"
@@ -5205,7 +5289,11 @@
 	  case $host,$output,$installed,$module,$dlname in
 	    *cygwin*,*lai,yes,no,*.dll | *mingw*,*lai,yes,no,*.dll) tdlname=../bin/$dlname ;;
 	  esac
-	  $echo > $output "\
+	  # Do not add duplicates
+	  if test "$installed" = yes && test "$D"; then
+	    install_libdir=`echo "$install_libdir" |sed -e "s:$D:/:g" -e 's:/\+:/:g'`
+	  fi
+	  $ECHO > $output "\
 # $outputname - a libtool library file
 # Generated by $PROGRAM - GNU $PACKAGE $VERSION$TIMESTAMP
 #
@@ -5242,7 +5330,7 @@
 # Directory that this library needs to be installed in:
 libdir='$install_libdir'"
 	  if test "$installed" = no && test "$need_relink" = yes && test "$fast_install" = no; then
-	    $echo >> $output "\
+	    $ECHO >> $output "\
 relink_command=\"$relink_command\""
 	  fi
 	done
@@ -5265,9 +5353,9 @@
     # install_prog (especially on Windows NT).
     if test "$nonopt" = "$SHELL" || test "$nonopt" = /bin/sh ||
        # Allow the use of GNU shtool's install command.
-       $echo "X$nonopt" | $Xsed | grep shtool > /dev/null; then
+       $ECHO "X$nonopt" | $Xsed | grep shtool > /dev/null; then
       # Aesthetically quote it.
-      arg=`$echo "X$nonopt" | $Xsed -e "$sed_quote_subst"`
+      arg=`$ECHO "X$nonopt" | $Xsed -e "$sed_quote_subst"`
       case $arg in
       *[\[\~\#\^\&\*\(\)\{\}\|\;\<\>\?\'\ \	]*|*]*)
 	arg="\"$arg\""
@@ -5283,7 +5371,7 @@
 
     # The real first argument should be the name of the installation program.
     # Aesthetically quote it.
-    arg=`$echo "X$arg" | $Xsed -e "$sed_quote_subst"`
+    arg=`$ECHO "X$arg" | $Xsed -e "$sed_quote_subst"`
     case $arg in
     *[\[\~\#\^\&\*\(\)\{\}\|\;\<\>\?\'\ \	]*|*]*)
       arg="\"$arg\""
@@ -5331,7 +5419,7 @@
       esac
 
       # Aesthetically quote the argument.
-      arg=`$echo "X$arg" | $Xsed -e "$sed_quote_subst"`
+      arg=`$ECHO "X$arg" | $Xsed -e "$sed_quote_subst"`
       case $arg in
       *[\[\~\#\^\&\*\(\)\{\}\|\;\<\>\?\'\ \	]*|*]*)
 	arg="\"$arg\""
@@ -5341,29 +5429,29 @@
     done
 
     if test -z "$install_prog"; then
-      $echo "$modename: you must specify an install program" 1>&2
-      $echo "$help" 1>&2
+      $ECHO "$modename: you must specify an install program" 1>&2
+      $ECHO "$help" 1>&2
       exit 1
     fi
 
     if test -n "$prev"; then
-      $echo "$modename: the \`$prev' option requires an argument" 1>&2
-      $echo "$help" 1>&2
+      $ECHO "$modename: the \`$prev' option requires an argument" 1>&2
+      $ECHO "$help" 1>&2
       exit 1
     fi
 
     if test -z "$files"; then
       if test -z "$dest"; then
-	$echo "$modename: no file or destination specified" 1>&2
+	$ECHO "$modename: no file or destination specified" 1>&2
       else
-	$echo "$modename: you must specify a destination" 1>&2
+	$ECHO "$modename: you must specify a destination" 1>&2
       fi
-      $echo "$help" 1>&2
+      $ECHO "$help" 1>&2
       exit 1
     fi
 
     # Strip any trailing slash from the destination.
-    dest=`$echo "X$dest" | $Xsed -e 's%/$%%'`
+    dest=`$ECHO "X$dest" | $Xsed -e 's%/$%%'`
 
     # Check to see that the destination is a directory.
     test -d "$dest" && isdir=yes
@@ -5371,15 +5459,15 @@
       destdir="$dest"
       destname=
     else
-      destdir=`$echo "X$dest" | $Xsed -e 's%/[^/]*$%%'`
+      destdir=`$ECHO "X$dest" | $Xsed -e 's%/[^/]*$%%'`
       test "X$destdir" = "X$dest" && destdir=.
-      destname=`$echo "X$dest" | $Xsed -e 's%^.*/%%'`
+      destname=`$ECHO "X$dest" | $Xsed -e 's%^.*/%%'`
 
       # Not a directory, so check to see that there is only one file specified.
       set dummy $files
       if test "$#" -gt 2; then
-	$echo "$modename: \`$dest' is not a directory" 1>&2
-	$echo "$help" 1>&2
+	$ECHO "$modename: \`$dest' is not a directory" 1>&2
+	$ECHO "$help" 1>&2
 	exit 1
       fi
     fi
@@ -5390,8 +5478,8 @@
 	case $file in
 	*.lo) ;;
 	*)
-	  $echo "$modename: \`$destdir' must be an absolute directory name" 1>&2
-	  $echo "$help" 1>&2
+	  $ECHO "$modename: \`$destdir' must be an absolute directory name" 1>&2
+	  $ECHO "$help" 1>&2
 	  exit 1
 	  ;;
 	esac
@@ -5419,8 +5507,8 @@
 	# Check to see that this really is a libtool archive.
 	if (${SED} -e '2q' $file | grep "^# Generated by .*$PACKAGE") >/dev/null 2>&1; then :
 	else
-	  $echo "$modename: \`$file' is not a valid libtool archive" 1>&2
-	  $echo "$help" 1>&2
+	  $ECHO "$modename: \`$file' is not a valid libtool archive" 1>&2
+	  $ECHO "$help" 1>&2
 	  exit 1
 	fi
 
@@ -5447,13 +5535,13 @@
 	  esac
 	fi
 
-	dir=`$echo "X$file" | $Xsed -e 's%/[^/]*$%%'`/
+	dir=`$ECHO "X$file" | $Xsed -e 's%/[^/]*$%%'`/
 	test "X$dir" = "X$file/" && dir=
 	dir="$dir$objdir"
 
 	if test -n "$relink_command"; then
 	  # Determine the prefix the user has applied to our future dir.
-	  inst_prefix_dir=`$echo "$destdir" | $SED "s%$libdir\$%%"`
+	  inst_prefix_dir=`$ECHO "$destdir" | $SED "s%$libdir\$%%"`
 
 	  # Don't allow the user to place us outside of our expected
 	  # location b/c this prevents finding dependent libraries that
@@ -5462,22 +5550,22 @@
 	  # are installed into $libdir/../bin (currently, that works fine)
 	  # but it's something to keep an eye on.
 	  if test "$inst_prefix_dir" = "$destdir"; then
-	    $echo "$modename: error: cannot install \`$file' to a directory not ending in $libdir" 1>&2
+	    $ECHO "$modename: error: cannot install \`$file' to a directory not ending in $libdir" 1>&2
 	    exit 1
 	  fi
 
 	  if test -n "$inst_prefix_dir"; then
 	    # Stick the inst_prefix_dir data into the link command.
-	    relink_command=`$echo "$relink_command" | $SED "s%@inst_prefix_dir@%-inst-prefix-dir $inst_prefix_dir%"`
+	    relink_command=`$ECHO "$relink_command" | $SED "s%@inst_prefix_dir@%-inst-prefix-dir $inst_prefix_dir%"`
 	  else
-	    relink_command=`$echo "$relink_command" | $SED "s%@inst_prefix_dir@%%"`
+	    relink_command=`$ECHO "$relink_command" | $SED "s%@inst_prefix_dir@%%"`
 	  fi
 
-	  $echo "$modename: warning: relinking \`$file'" 1>&2
+	  $ECHO "$modename: warning: relinking \`$file'" 1>&2
 	  $show "$relink_command"
 	  if $run eval "$relink_command"; then :
 	  else
-	    $echo "$modename: error: relink \`$file' with the above command before installing it" 1>&2
+	    $ECHO "$modename: error: relink \`$file' with the above command before installing it" 1>&2
 	    exit 1
 	  fi
 	fi
@@ -5524,7 +5612,7 @@
 	fi
 
 	# Install the pseudo-library for information purposes.
-	name=`$echo "X$file" | $Xsed -e 's%^.*/%%'`
+	name=`$ECHO "X$file" | $Xsed -e 's%^.*/%%'`
 	instname="$dir/$name"i
 	$show "$install_prog $instname $destdir/$name"
 	$run eval "$install_prog $instname $destdir/$name" || exit $?
@@ -5540,22 +5628,22 @@
 	if test -n "$destname"; then
 	  destfile="$destdir/$destname"
 	else
-	  destfile=`$echo "X$file" | $Xsed -e 's%^.*/%%'`
+	  destfile=`$ECHO "X$file" | $Xsed -e 's%^.*/%%'`
 	  destfile="$destdir/$destfile"
 	fi
 
 	# Deduce the name of the destination old-style object file.
 	case $destfile in
 	*.lo)
-	  staticdest=`$echo "X$destfile" | $Xsed -e "$lo2o"`
+	  staticdest=`$ECHO "X$destfile" | $Xsed -e "$lo2o"`
 	  ;;
 	*.$objext)
 	  staticdest="$destfile"
 	  destfile=
 	  ;;
 	*)
-	  $echo "$modename: cannot copy a libtool object to \`$destfile'" 1>&2
-	  $echo "$help" 1>&2
+	  $ECHO "$modename: cannot copy a libtool object to \`$destfile'" 1>&2
+	  $ECHO "$help" 1>&2
 	  exit 1
 	  ;;
 	esac
@@ -5569,7 +5657,7 @@
 	# Install the old object if enabled.
 	if test "$build_old_libs" = yes; then
 	  # Deduce the name of the old-style object file.
-	  staticobj=`$echo "X$file" | $Xsed -e "$lo2o"`
+	  staticobj=`$ECHO "X$file" | $Xsed -e "$lo2o"`
 
 	  $show "$install_prog $staticobj $staticdest"
 	  $run eval "$install_prog \$staticobj \$staticdest" || exit $?
@@ -5582,7 +5670,7 @@
 	if test -n "$destname"; then
 	  destfile="$destdir/$destname"
 	else
-	  destfile=`$echo "X$file" | $Xsed -e 's%^.*/%%'`
+	  destfile=`$ECHO "X$file" | $Xsed -e 's%^.*/%%'`
 	  destfile="$destdir/$destfile"
 	fi
 
@@ -5593,7 +5681,7 @@
 	case $file in
 	  *.exe)
 	    if test ! -f "$file"; then
-	      file=`$echo $file|${SED} 's,.exe$,,'`
+	      file=`$ECHO $file|${SED} 's,.exe$,,'`
 	      stripped_ext=".exe"
 	    fi
 	    ;;
@@ -5602,7 +5690,7 @@
 	# Do a test to see if this is really a libtool program.
 	case $host in
 	*cygwin*|*mingw*)
-	    wrapper=`$echo $file | ${SED} -e 's,.exe$,,'`
+	    wrapper=`$ECHO $file | ${SED} -e 's,.exe$,,'`
 	    ;;
 	*)
 	    wrapper=$file
@@ -5627,7 +5715,7 @@
 
 	  # Check the variables that should have been set.
 	  if test -z "$notinst_deplibs"; then
-	    $echo "$modename: invalid libtool wrapper script \`$wrapper'" 1>&2
+	    $ECHO "$modename: invalid libtool wrapper script \`$wrapper'" 1>&2
 	    exit 1
 	  fi
 
@@ -5642,9 +5730,9 @@
 	      *) . ./$lib ;;
 	      esac
 	    fi
-	    libfile="$libdir/"`$echo "X$lib" | $Xsed -e 's%^.*/%%g'` ### testsuite: skip nested quoting test
+	    libfile="$libdir/"`$ECHO "X$lib" | $Xsed -e 's%^.*/%%g'` ### testsuite: skip nested quoting test
 	    if test -n "$libdir" && test ! -f "$libfile"; then
-	      $echo "$modename: warning: \`$lib' has not been installed in \`$libdir'" 1>&2
+	      $ECHO "$modename: warning: \`$lib' has not been installed in \`$libdir'" 1>&2
 	      finalize=no
 	    fi
 	  done
@@ -5671,28 +5759,28 @@
 	      tmpdir="$tmpdir/libtool-$$"
 	      if $mkdir "$tmpdir" && chmod 700 "$tmpdir"; then :
 	      else
-		$echo "$modename: error: cannot create temporary directory \`$tmpdir'" 1>&2
+		$ECHO "$modename: error: cannot create temporary directory \`$tmpdir'" 1>&2
 		continue
 	      fi
-	      file=`$echo "X$file$stripped_ext" | $Xsed -e 's%^.*/%%'`
+	      file=`$ECHO "X$file$stripped_ext" | $Xsed -e 's%^.*/%%'`
 	      outputname="$tmpdir/$file"
 	      # Replace the output file specification.
-	      relink_command=`$echo "X$relink_command" | $Xsed -e 's%@OUTPUT@%'"$outputname"'%g'`
+	      relink_command=`$ECHO "X$relink_command" | $Xsed -e 's%@OUTPUT@%'"$outputname"'%g'`
 
 	      $show "$relink_command"
 	      if $run eval "$relink_command"; then :
 	      else
-		$echo "$modename: error: relink \`$file' with the above command before installing it" 1>&2
+		$ECHO "$modename: error: relink \`$file' with the above command before installing it" 1>&2
 		${rm}r "$tmpdir"
 		continue
 	      fi
 	      file="$outputname"
 	    else
-	      $echo "$modename: warning: cannot relink \`$file'" 1>&2
+	      $ECHO "$modename: warning: cannot relink \`$file'" 1>&2
 	    fi
 	  else
 	    # Install the binary that we compiled earlier.
-	    file=`$echo "X$file$stripped_ext" | $Xsed -e "s%\([^/]*\)$%$objdir/\1%"`
+	    file=`$ECHO "X$file$stripped_ext" | $Xsed -e "s%\([^/]*\)$%$objdir/\1%"`
 	  fi
 	fi
 
@@ -5708,7 +5796,7 @@
 	    destfile=$destfile.exe
 	    ;;
 	  *:*.exe)
-	    destfile=`$echo $destfile | ${SED} -e 's,.exe$,,'`
+	    destfile=`$ECHO $destfile | ${SED} -e 's,.exe$,,'`
 	    ;;
 	  esac
 	  ;;
@@ -5721,7 +5809,7 @@
     done
 
     for file in $staticlibs; do
-      name=`$echo "X$file" | $Xsed -e 's%^.*/%%'`
+      name=`$ECHO "X$file" | $Xsed -e 's%^.*/%%'`
 
       # Set up the ranlib parameters.
       oldlib="$destdir/$name"
@@ -5746,7 +5834,7 @@
     done
 
     if test -n "$future_libdirs"; then
-      $echo "$modename: warning: remember to run \`$progname --finish$future_libdirs'" 1>&2
+      $ECHO "$modename: warning: remember to run \`$progname --finish$future_libdirs'" 1>&2
     fi
 
     if test -n "$current_libdirs"; then
@@ -5795,40 +5883,40 @@
     # Exit here if they wanted silent mode.
     exit 0
 
-    $echo "----------------------------------------------------------------------"
-    $echo "Libraries have been installed in:"
+    $ECHO "----------------------------------------------------------------------"
+    $ECHO "Libraries have been installed in:"
     for libdir in $libdirs; do
-      $echo "   $libdir"
+      $ECHO "   $libdir"
     done
-    $echo
-    $echo "If you ever happen to want to link against installed libraries"
-    $echo "in a given directory, LIBDIR, you must either use libtool, and"
-    $echo "specify the full pathname of the library, or use the \`-LLIBDIR'"
-    $echo "flag during linking and do at least one of the following:"
+    $ECHO
+    $ECHO "If you ever happen to want to link against installed libraries"
+    $ECHO "in a given directory, LIBDIR, you must either use libtool, and"
+    $ECHO "specify the full pathname of the library, or use the \`-LLIBDIR'"
+    $ECHO "flag during linking and do at least one of the following:"
     if test -n "$shlibpath_var"; then
-      $echo "   - add LIBDIR to the \`$shlibpath_var' environment variable"
-      $echo "     during execution"
+      $ECHO "   - add LIBDIR to the \`$shlibpath_var' environment variable"
+      $ECHO "     during execution"
     fi
     if test -n "$runpath_var"; then
-      $echo "   - add LIBDIR to the \`$runpath_var' environment variable"
-      $echo "     during linking"
+      $ECHO "   - add LIBDIR to the \`$runpath_var' environment variable"
+      $ECHO "     during linking"
     fi
     if test -n "$hardcode_libdir_flag_spec"; then
       libdir=LIBDIR
       eval flag=\"$hardcode_libdir_flag_spec\"
 
-      $echo "   - use the \`$flag' linker flag"
+      $ECHO "   - use the \`$flag' linker flag"
     fi
     if test -n "$admincmds"; then
-      $echo "   - have your system administrator run these commands:$admincmds"
+      $ECHO "   - have your system administrator run these commands:$admincmds"
     fi
     if test -f /etc/ld.so.conf; then
-      $echo "   - have your system administrator add LIBDIR to \`/etc/ld.so.conf'"
+      $ECHO "   - have your system administrator add LIBDIR to \`/etc/ld.so.conf'"
     fi
-    $echo
-    $echo "See any operating system documentation about shared libraries for"
-    $echo "more information, such as the ld(1) and ld.so(8) manual pages."
-    $echo "----------------------------------------------------------------------"
+    $ECHO
+    $ECHO "See any operating system documentation about shared libraries for"
+    $ECHO "more information, such as the ld(1) and ld.so(8) manual pages."
+    $ECHO "----------------------------------------------------------------------"
     exit 0
     ;;
 
@@ -5839,16 +5927,16 @@
     # The first argument is the command name.
     cmd="$nonopt"
     if test -z "$cmd"; then
-      $echo "$modename: you must specify a COMMAND" 1>&2
-      $echo "$help"
+      $ECHO "$modename: you must specify a COMMAND" 1>&2
+      $ECHO "$help"
       exit 1
     fi
 
     # Handle -dlopen flags immediately.
     for file in $execute_dlfiles; do
       if test ! -f "$file"; then
-	$echo "$modename: \`$file' is not a file" 1>&2
-	$echo "$help" 1>&2
+	$ECHO "$modename: \`$file' is not a file" 1>&2
+	$ECHO "$help" 1>&2
 	exit 1
       fi
 
@@ -5858,8 +5946,8 @@
 	# Check to see that this really is a libtool archive.
 	if (${SED} -e '2q' $file | grep "^# Generated by .*$PACKAGE") >/dev/null 2>&1; then :
 	else
-	  $echo "$modename: \`$lib' is not a valid libtool archive" 1>&2
-	  $echo "$help" 1>&2
+	  $ECHO "$modename: \`$lib' is not a valid libtool archive" 1>&2
+	  $ECHO "$help" 1>&2
 	  exit 1
 	fi
 
@@ -5876,29 +5964,29 @@
 	# Skip this library if it cannot be dlopened.
 	if test -z "$dlname"; then
 	  # Warn if it was a shared library.
-	  test -n "$library_names" && $echo "$modename: warning: \`$file' was not linked with \`-export-dynamic'"
+	  test -n "$library_names" && $ECHO "$modename: warning: \`$file' was not linked with \`-export-dynamic'"
 	  continue
 	fi
 
-	dir=`$echo "X$file" | $Xsed -e 's%/[^/]*$%%'`
+	dir=`$ECHO "X$file" | $Xsed -e 's%/[^/]*$%%'`
 	test "X$dir" = "X$file" && dir=.
 
 	if test -f "$dir/$objdir/$dlname"; then
 	  dir="$dir/$objdir"
 	else
-	  $echo "$modename: cannot find \`$dlname' in \`$dir' or \`$dir/$objdir'" 1>&2
+	  $ECHO "$modename: cannot find \`$dlname' in \`$dir' or \`$dir/$objdir'" 1>&2
 	  exit 1
 	fi
 	;;
 
       *.lo)
 	# Just add the directory containing the .lo file.
-	dir=`$echo "X$file" | $Xsed -e 's%/[^/]*$%%'`
+	dir=`$ECHO "X$file" | $Xsed -e 's%/[^/]*$%%'`
 	test "X$dir" = "X$file" && dir=.
 	;;
 
       *)
-	$echo "$modename: warning \`-dlopen' is ignored for non-libtool libraries and objects" 1>&2
+	$ECHO "$modename: warning \`-dlopen' is ignored for non-libtool libraries and objects" 1>&2
 	continue
 	;;
       esac
@@ -5940,7 +6028,7 @@
 	;;
       esac
       # Quote arguments (to preserve shell metacharacters).
-      file=`$echo "X$file" | $Xsed -e "$sed_quote_subst"`
+      file=`$ECHO "X$file" | $Xsed -e "$sed_quote_subst"`
       args="$args \"$file\""
     done
 
@@ -5963,10 +6051,10 @@
     else
       # Display what would be done.
       if test -n "$shlibpath_var"; then
-	eval "\$echo \"\$shlibpath_var=\$$shlibpath_var\""
-	$echo "export $shlibpath_var"
+	eval "\$ECHO \"\$shlibpath_var=\$$shlibpath_var\""
+	$ECHO "export $shlibpath_var"
       fi
-      $echo "$cmd$args"
+      $ECHO "$cmd$args"
       exit 0
     fi
     ;;
@@ -5993,8 +6081,8 @@
     done
 
     if test -z "$rm"; then
-      $echo "$modename: you must specify an RM program" 1>&2
-      $echo "$help" 1>&2
+      $ECHO "$modename: you must specify an RM program" 1>&2
+      $ECHO "$help" 1>&2
       exit 1
     fi
 
@@ -6002,14 +6090,14 @@
 
     origobjdir="$objdir"
     for file in $files; do
-      dir=`$echo "X$file" | $Xsed -e 's%/[^/]*$%%'`
+      dir=`$ECHO "X$file" | $Xsed -e 's%/[^/]*$%%'`
       if test "X$dir" = "X$file"; then
 	dir=.
 	objdir="$origobjdir"
       else
 	objdir="$dir/$origobjdir"
       fi
-      name=`$echo "X$file" | $Xsed -e 's%^.*/%%'`
+      name=`$ECHO "X$file" | $Xsed -e 's%^.*/%%'`
       test "$mode" = uninstall && objdir="$dir"
 
       # Remember objdir for removal later, being careful to avoid duplicates
@@ -6108,8 +6196,8 @@
 	  noexename=$name
 	  case $file in
 	  *.exe) 
-	    file=`$echo $file|${SED} 's,.exe$,,'`
-	    noexename=`$echo $name|${SED} 's,.exe$,,'`
+	    file=`$ECHO $file|${SED} 's,.exe$,,'`
+	    noexename=`$ECHO $name|${SED} 's,.exe$,,'`
 	    # $file with .exe has already been added to rmfiles,
 	    # add $file without .exe
 	    rmfiles="$rmfiles $file"
@@ -6150,15 +6238,15 @@
     ;;
 
   "")
-    $echo "$modename: you must specify a MODE" 1>&2
-    $echo "$generic_help" 1>&2
+    $ECHO "$modename: you must specify a MODE" 1>&2
+    $ECHO "$generic_help" 1>&2
     exit 1
     ;;
   esac
 
   if test -z "$exec_cmd"; then
-    $echo "$modename: invalid operation mode \`$mode'" 1>&2
-    $echo "$generic_help" 1>&2
+    $ECHO "$modename: invalid operation mode \`$mode'" 1>&2
+    $ECHO "$generic_help" 1>&2
     exit 1
   fi
 fi # test -z "$show_help"
@@ -6170,7 +6258,7 @@
 
 # We need to display help for each of the modes.
 case $mode in
-"") $echo \
+"") $ECHO \
 "Usage: $modename [OPTION]... [MODE-ARG]...
 
 Provide generalized library-building support services.
@@ -6205,7 +6293,7 @@
   ;;
 
 clean)
-  $echo \
+  $ECHO \
 "Usage: $modename [OPTION]... --mode=clean RM [RM-OPTION]... FILE...
 
 Remove files from the build directory.
@@ -6219,7 +6307,7 @@
   ;;
 
 compile)
-  $echo \
+  $ECHO \
 "Usage: $modename [OPTION]... --mode=compile COMPILE-COMMAND... SOURCEFILE
 
 Compile a source file into a libtool library object.
@@ -6240,7 +6328,7 @@
   ;;
 
 execute)
-  $echo \
+  $ECHO \
 "Usage: $modename [OPTION]... --mode=execute COMMAND [ARGS]...
 
 Automatically set library path, then run a program.
@@ -6260,7 +6348,7 @@
   ;;
 
 finish)
-  $echo \
+  $ECHO \
 "Usage: $modename [OPTION]... --mode=finish [LIBDIR]...
 
 Complete the installation of libtool libraries.
@@ -6272,7 +6360,7 @@
   ;;
 
 install)
-  $echo \
+  $ECHO \
 "Usage: $modename [OPTION]... --mode=install INSTALL-COMMAND...
 
 Install executables or libraries.
@@ -6285,7 +6373,7 @@
   ;;
 
 link)
-  $echo \
+  $ECHO \
 "Usage: $modename [OPTION]... --mode=link LINK-COMMAND...
 
 Link object files or libraries together to form another library, or to
@@ -6338,7 +6426,7 @@
   ;;
 
 uninstall)
-  $echo \
+  $ECHO \
 "Usage: $modename [OPTION]... --mode=uninstall RM [RM-OPTION]... FILE...
 
 Remove libraries from an installation directory.
@@ -6352,14 +6440,14 @@
   ;;
 
 *)
-  $echo "$modename: invalid operation mode \`$mode'" 1>&2
-  $echo "$help" 1>&2
+  $ECHO "$modename: invalid operation mode \`$mode'" 1>&2
+  $ECHO "$help" 1>&2
   exit 1
   ;;
 esac
 
-$echo
-$echo "Try \`$modename --help' for more information about other modes."
+$ECHO
+$ECHO "Try \`$modename --help' for more information about other modes."
 
 exit 0
 
@@ -6380,7 +6468,7 @@
 # ### END LIBTOOL TAG CONFIG: disable-shared
 
 # ### BEGIN LIBTOOL TAG CONFIG: disable-static
-build_old_libs=`case $build_libtool_libs in yes) $echo no;; *) $echo yes;; esac`
+build_old_libs=`case $build_libtool_libs in yes) $ECHO no;; *) $ECHO yes;; esac`
 # ### END LIBTOOL TAG CONFIG: disable-static
 
 # Local Variables:
